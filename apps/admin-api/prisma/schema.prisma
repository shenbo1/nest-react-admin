generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SysDept {
  id        Int           @id @default(autoincrement())
  parentId  Int           @default(0) @map("parent_id")
  ancestors String?       @db.VarChar(500)
  name      String        @db.VarChar(50)
  sort      Int           @default(0)
  leader    String?       @db.VarChar(20)
  phone     String?       @db.VarChar(11)
  email     String?       @db.VarChar(50)
  status    Status        @default(ENABLED)
  createdBy String?       @map("created_by") @db.VarChar(64)
  createdAt DateTime      @default(now()) @map("created_at")
  updatedBy String?       @map("updated_by") @db.VarChar(64)
  updatedAt DateTime      @updatedAt @map("updated_at")
  deleted   Boolean       @default(false)
  deletedAt DateTime?     @map("deleted_at")
  roles     SysRoleDept[]
  users     SysUser[]

  @@index([parentId])
  @@index([deleted])
  @@map("sys_dept")
}

model SysMenu {
  id        Int           @id @default(autoincrement())
  parentId  Int           @default(0) @map("parent_id")
  name      String        @db.VarChar(50)
  path      String?       @db.VarChar(200)
  component String?       @db.VarChar(255)
  query     String?       @db.VarChar(255)
  perms     String?       @db.VarChar(100)
  type      MenuType
  icon      String?       @db.VarChar(100)
  sort      Int           @default(0)
  visible   Boolean       @default(true)
  status    Status        @default(ENABLED)
  isFrame   Boolean       @default(false) @map("is_frame")
  isCache   Boolean       @default(true) @map("is_cache")
  remark    String?       @db.VarChar(500)
  createdBy String?       @map("created_by") @db.VarChar(64)
  createdAt DateTime      @default(now()) @map("created_at")
  updatedBy String?       @map("updated_by") @db.VarChar(64)
  updatedAt DateTime      @updatedAt @map("updated_at")
  deleted   Boolean       @default(false)
  deletedAt DateTime?     @map("deleted_at")
  roles     SysRoleMenu[]

  @@index([parentId])
  @@index([deleted])
  @@map("sys_menu")
}

model SysRole {
  id        Int           @id @default(autoincrement())
  name      String        @db.VarChar(30)
  key       String        @db.VarChar(100)
  sort      Int           @default(0)
  dataScope DataScope     @default(ALL) @map("data_scope")
  status    Status        @default(ENABLED)
  remark    String?       @db.VarChar(500)
  createdBy String?       @map("created_by") @db.VarChar(64)
  createdAt DateTime      @default(now()) @map("created_at")
  updatedBy String?       @map("updated_by") @db.VarChar(64)
  updatedAt DateTime      @updatedAt @map("updated_at")
  deleted   Boolean       @default(false)
  deletedAt DateTime?     @map("deleted_at")
  depts     SysRoleDept[]
  menus     SysRoleMenu[]
  users     SysUserRole[]

  @@unique([key, deleted])
  @@index([deleted])
  @@index([status])
  @@map("sys_role")
}

model SysRoleMenu {
  roleId Int     @map("role_id")
  menuId Int     @map("menu_id")
  menu   SysMenu @relation(fields: [menuId], references: [id], onDelete: Cascade)
  role   SysRole @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([roleId, menuId])
  @@map("sys_role_menu")
}

model SysRoleDept {
  roleId Int     @map("role_id")
  deptId Int     @map("dept_id")
  dept   SysDept @relation(fields: [deptId], references: [id], onDelete: Cascade)
  role   SysRole @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([roleId, deptId])
  @@map("sys_role_dept")
}

model SysUser {
  id        Int           @id @default(autoincrement())
  deptId    Int?          @map("dept_id")
  username  String        @db.VarChar(30)
  password  String        @db.VarChar(100)
  nickname  String?       @db.VarChar(30)
  email     String?       @db.VarChar(50)
  phone     String?       @db.VarChar(11)
  gender    Gender        @default(UNKNOWN)
  avatar    String?       @db.VarChar(200)
  status    Status        @default(ENABLED)
  loginIp   String?       @map("login_ip") @db.VarChar(128)
  loginTime DateTime?     @map("login_time")
  remark    String?       @db.VarChar(500)
  createdBy String?       @map("created_by") @db.VarChar(64)
  createdAt DateTime      @default(now()) @map("created_at")
  updatedBy String?       @map("updated_by") @db.VarChar(64)
  updatedAt DateTime      @updatedAt @map("updated_at")
  deleted   Boolean       @default(false)
  deletedAt DateTime?     @map("deleted_at")
  dept      SysDept?      @relation(fields: [deptId], references: [id])
  roles     SysUserRole[]
  files     SysFile[]

  @@unique([username, deleted])
  @@index([deptId])
  @@index([deleted])
  @@index([status])
  @@map("sys_user")
}

model SysUserRole {
  userId Int     @map("user_id")
  roleId Int     @map("role_id")
  role   SysRole @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user   SysUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@map("sys_user_role")
}

/// 文件管理表
model SysFile {
  id           Int       @id @default(autoincrement())
  /// 存储文件名
  filename     String    @db.VarChar(255)
  /// 原始文件名
  originalName String    @map("original_name") @db.VarChar(255)
  /// 文件MIME类型
  mimetype     String    @db.VarChar(100)
  /// 文件大小(字节)
  size         Int
  /// 访问URL
  url          String    @db.VarChar(500)
  /// 文件类型: image/file
  fileType     String    @map("file_type") @db.VarChar(20)
  /// 上传人ID
  uploadedBy   Int?      @map("uploaded_by")
  /// 上传人
  uploader     SysUser?  @relation(fields: [uploadedBy], references: [id])
  /// 创建时间
  createdAt    DateTime  @default(now()) @map("created_at")
  /// 更新时间
  updatedAt    DateTime  @updatedAt @map("updated_at")
  /// 是否删除
  deleted      Boolean   @default(false)
  /// 删除时间
  deletedAt    DateTime? @map("deleted_at")

  @@index([fileType])
  @@index([uploadedBy])
  @@index([deleted])
  @@map("sys_file")
}

/// 运营配置表
model Banner {
  id        Int       @id @default(autoincrement())
  /// 轮播图名称
  name      String    @db.VarChar(100)
  /// 编码
  code      String?   @db.VarChar(50)
  /// 图片地址
  image     String    @db.VarChar(500)
  /// 跳转链接
  linkUrl   String?   @map("link_url") @db.VarChar(500)
  /// 类型：1-图片 2-视频
  type      Int       @default(1)
  /// 展示位置：首页、分类页等
  position  String?   @db.VarChar(50)
  /// 开始时间
  startTime DateTime? @map("start_time")
  /// 结束时间
  endTime   DateTime? @map("end_time")
  /// 描述
  content   String?
  /// 排序
  sort      Int       @default(0)
  /// 状态
  status    Status    @default(ENABLED)
  /// 备注
  remark    String?   @db.VarChar(500)
  /// 创建者ID
  createdBy String?   @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt DateTime  @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy String?   @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt DateTime  @updatedAt @map("updated_at")
  /// 删除标记
  deleted   Boolean   @default(false) @map("deleted")
  /// 删除时间
  deletedAt DateTime? @map("deleted_at")

  @@index([position])
  @@index([sort])
  @@map("mall_banner")
}

/// 文章表
model Article {
  id        Int       @id @default(autoincrement())
  /// 文章标题
  name      String    @db.VarChar(200)
  /// 文章编码
  code      String?   @db.VarChar(50)
  /// 文章封面图
  cover     String?   @db.VarChar(500)
  /// 文章摘要
  summary   String?   @db.VarChar(500)
  /// 文章内容
  content   String?
  /// 排序
  sort      Int       @default(0)
  /// 状态
  status    Status    @default(ENABLED)
  /// 备注
  remark    String?   @db.VarChar(500)
  /// 创建者ID
  createdBy String?   @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt DateTime  @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy String?   @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt DateTime  @updatedAt @map("updated_at")
  /// 删除标记
  deleted   Boolean   @default(false)
  /// 删除时间
  deletedAt DateTime? @map("deleted_at")

  @@index([sort])
  @@index([status])
  @@map("cms_article")
}

/// 商品分类表
model Category {
  id        Int        @id @default(autoincrement())
  /// 分类名称
  name      String     @db.VarChar(100)
  /// 分类编码
  code      String?    @db.VarChar(50)
  /// 父分类ID
  parentId  Int?       @map("parent_id")
  /// 祖先节点ID列表
  ancestors String?    @db.VarChar(500)
  /// 层级
  level     Int        @default(1)
  /// 分类图片
  image     String?    @db.VarChar(500)
  /// 分类描述
  content   String?
  /// 排序
  sort      Int        @default(0)
  /// 状态
  status    Status     @default(ENABLED)
  /// 备注
  remark    String?    @db.VarChar(500)
  /// 创建者ID
  createdBy String?    @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt DateTime   @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy String?    @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt DateTime   @updatedAt @map("updated_at")
  /// 删除标记
  deleted   Boolean    @default(false) @map("deleted")
  /// 删除时间
  deletedAt DateTime?  @map("deleted_at")
  parent    Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  children  Category[] @relation("CategoryToCategory")
  products  Product[]

  @@index([parentId])
  @@index([ancestors])
  @@map("mall_category")
}

/// 会员管理表
model Member {
  id            Int       @id @default(autoincrement())
  /// 用户名
  username      String    @unique @db.VarChar(50)
  /// 密码
  password      String    @default("") @db.VarChar(100)
  /// 昵称
  nickname      String?   @db.VarChar(100)
  /// 手机号
  phone         String?   @unique @db.VarChar(20)
  /// 邮箱
  email         String?   @unique @db.VarChar(100)
  /// 头像
  avatar        String?   @db.VarChar(500)
  /// 性别：MALE-男 FEMALE-女 UNKNOWN-未知
  gender        Gender?
  /// 生日
  birthday      DateTime?
  /// 会员等级规则ID
  memberLevelId Int?      @map("member_level_id")
  /// 积分
  points        Int       @default(0)
  /// 余额
  balance       Decimal?  @db.Decimal(10, 2)
  /// 累计消费
  totalAmount   Decimal?  @map("total_amount") @db.Decimal(10, 2)
  /// 成长值
  growth        Int       @default(0)
  /// 状态
  status        Status    @default(ENABLED)
  /// 最后登录时间
  lastLoginTime DateTime? @map("last_login_time")
  /// 最后登录IP
  lastLoginIp   String?   @map("last_login_ip") @db.VarChar(50)
  /// 备注
  remark        String?   @db.VarChar(500)
  /// 创建者ID
  createdBy     String?   @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt     DateTime  @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy     String?   @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt     DateTime  @updatedAt @map("updated_at")
  /// 删除标记
  deleted       Boolean   @default(false) @map("deleted")
  /// 删除时间
  deletedAt     DateTime? @map("deleted_at")
  orders        Order[]
  addresses     MemberAddress[]
  invoices      MemberInvoiceInfo[]
  loginLogs     MemberLoginLog[]
  balanceLogs   MemberBalanceLog[]
  pointLogs     MemberPointLog[]
  carts         Cart[]
  cartItems     CartItem[]
  memberLevel   MemberLevelRule? @relation("MemberLevel", fields: [memberLevelId], references: [id])

  @@index([phone])
  @@index([email])
  @@index([memberLevelId])
  @@index([status])
  @@index([deleted])
  @@map("member")
}

/// 会员地址表
model MemberAddress {
  id          Int      @id @default(autoincrement())
  /// 会员ID
  memberId    Int      @map("member_id")
  /// 收货人
  receiver    String   @db.VarChar(100)
  /// 收货电话
  phone       String   @db.VarChar(20)
  /// 省份
  province    String?  @db.VarChar(50)
  /// 城市
  city        String?  @db.VarChar(50)
  /// 区县
  district    String?  @db.VarChar(50)
  /// 街道
  street      String?  @db.VarChar(100)
  /// 邮编
  postalCode  String?  @map("postal_code") @db.VarChar(20)
  /// 详细地址
  address     String   @db.VarChar(500)
  /// 是否默认
  isDefault   Boolean  @default(false) @map("is_default")
  /// 备注
  remark      String?  @db.VarChar(500)
  /// 创建者ID
  createdBy   String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt   DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy   String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt   DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted     Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt   DateTime? @map("deleted_at")
  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  orders      Order[]

  @@index([memberId])
  @@index([isDefault])
  @@index([deleted])
  @@map("member_address")
}

/// 会员登录日志
model MemberLoginLog {
  id        Int      @id @default(autoincrement())
  /// 会员ID
  memberId  Int      @map("member_id")
  /// 登录IP
  ipaddr    String?  @db.VarChar(50)
  /// 登录地点
  loginLocation String? @map("login_location") @db.VarChar(255)
  /// 浏览器
  browser   String?  @db.VarChar(50)
  /// 操作系统
  os        String?  @db.VarChar(50)
  /// 状态（0成功 1失败）
  status    String   @default("0") @db.Char(1)
  /// 提示信息
  msg       String?  @db.VarChar(255)
  /// 登录时间
  loginTime DateTime @default(now()) @map("login_time")
  /// 创建者ID
  createdBy String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted   Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt DateTime? @map("deleted_at")
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([loginTime])
  @@index([deleted])
  @@map("member_login_log")
}

/// 会员余额流水
model MemberBalanceLog {
  id           Int      @id @default(autoincrement())
  /// 会员ID
  memberId     Int      @map("member_id")
  /// 变动类型
  type         BalanceChangeType
  /// 变动金额（正负）
  amount       Decimal  @db.Decimal(10, 2)
  /// 变动前余额
  beforeAmount Decimal  @map("before_amount") @db.Decimal(10, 2)
  /// 变动后余额
  afterAmount  Decimal  @map("after_amount") @db.Decimal(10, 2)
  /// 过期时间
  expireTime   DateTime? @map("expire_time")
  /// 关联订单ID（可选）
  orderId      Int?     @map("order_id")
  /// 备注
  remark       String?  @db.VarChar(500)
  /// 创建者ID
  createdBy    String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt    DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy    String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt    DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted      Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt    DateTime? @map("deleted_at")
  member       Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([orderId])
  @@index([createdAt])
  @@index([deleted])
  @@map("member_balance_log")
}

/// 会员积分流水
model MemberPointLog {
  id          Int      @id @default(autoincrement())
  /// 会员ID
  memberId    Int      @map("member_id")
  /// 变动类型
  type        PointChangeType
  /// 变动积分（正负）
  points      Int
  /// 变动前积分
  beforePoints Int     @map("before_points")
  /// 变动后积分
  afterPoints  Int     @map("after_points")
  /// 过期时间
  expireTime   DateTime? @map("expire_time")
  /// 关联订单ID（可选）
  orderId     Int?     @map("order_id")
  /// 备注
  remark      String?  @db.VarChar(500)
  /// 创建者ID
  createdBy   String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt   DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy   String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt   DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted     Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt   DateTime? @map("deleted_at")
  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([orderId])
  @@index([createdAt])
  @@index([deleted])
  @@map("member_point_log")
}

/// 会员等级规则
model MemberLevelRule {
  id           Int      @id @default(autoincrement())
  /// 等级编码
  code         String   @unique @db.VarChar(20)
  /// 等级名称
  name         String   @db.VarChar(50)
  /// 等级序号
  level        Int
  /// 成长值起始
  minGrowth    Int      @map("min_growth")
  /// 成长值结束（为空表示无限）
  maxGrowth    Int?     @map("max_growth")
  /// 折扣率（0~1）
  discountRate Decimal? @map("discount_rate") @db.Decimal(5, 4)
  /// 积分倍率
  pointsRate   Decimal? @map("points_rate") @db.Decimal(5, 2)
  /// 权益说明（横向扩展）
  benefits     String?  @db.VarChar(1000)
  /// 状态
  status       Status   @default(ENABLED)
  /// 排序
  sort         Int      @default(0)
  /// 备注
  remark       String?  @db.VarChar(500)
  /// 创建者ID
  createdBy    String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt    DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy    String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt    DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted      Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt    DateTime? @map("deleted_at")
  members      Member[] @relation("MemberLevel")

  @@index([level])
  @@index([minGrowth, maxGrowth])
  @@index([deleted])
  @@map("member_level_rule")
}

/// 发票主数据（会员发票抬头）
model MemberInvoiceInfo {
  id             Int      @id @default(autoincrement())
  /// 会员ID
  memberId       Int      @map("member_id")
  /// 发票类型
  invoiceType    InvoiceType?  @map("invoice_type")
  /// 发票抬头类型
  invoiceTitleType InvoiceTitleType? @map("invoice_title_type")
  /// 发票抬头
  invoiceTitle   String?  @map("invoice_title") @db.VarChar(100)
  /// 发票税号
  invoiceTaxNo   String?  @map("invoice_tax_no") @db.VarChar(50)
  /// 发票内容
  invoiceContent String?  @map("invoice_content") @db.VarChar(200)
  /// 开票邮箱
  invoiceEmail   String?  @map("invoice_email") @db.VarChar(100)
  /// 开票电话
  invoicePhone   String?  @map("invoice_phone") @db.VarChar(30)
  /// 开票地址
  invoiceAddress String?  @map("invoice_address") @db.VarChar(200)
  /// 开户行
  bankName       String?  @map("bank_name") @db.VarChar(100)
  /// 银行账号
  bankAccount    String?  @map("bank_account") @db.VarChar(50)
  /// 是否默认
  isDefault      Boolean  @default(false) @map("is_default")
  /// 备注
  remark         String?  @db.VarChar(500)
  /// 创建者ID
  createdBy      String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt      DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy      String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt      DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted        Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt      DateTime? @map("deleted_at")
  member         Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([invoiceTaxNo])
  @@index([isDefault])
  @@index([deleted])
  @@map("member_invoice_info")
}

/// 订单管理表
model Order {
  id             Int            @id @default(autoincrement())
  /// 订单号
  orderNo        String         @unique @map("order_no") @db.VarChar(50)
  /// 订单类型
  orderType      String?        @map("order_type") @db.VarChar(30)
  /// 订单来源
  orderSource    String?        @map("order_source") @db.VarChar(30)
  /// 会员ID
  memberId       Int?           @map("member_id")
  /// 会员地址ID（可为空，保留地址快照字段）
  memberAddressId Int?          @map("member_address_id")
  /// 商品金额
  goodsAmount    Decimal?       @map("goods_amount") @db.Decimal(10, 2)
  /// 订单总金额
  totalAmount    Decimal        @map("total_amount") @db.Decimal(10, 2)
  /// 优惠金额
  discountAmount Decimal?       @map("discount_amount") @db.Decimal(10, 2)
  /// 优惠券抵扣金额
  couponAmount   Decimal?       @map("coupon_amount") @db.Decimal(10, 2)
  /// 积分抵扣金额
  pointsAmount   Decimal?       @map("points_amount") @db.Decimal(10, 2)
  /// 税费
  taxAmount      Decimal?       @map("tax_amount") @db.Decimal(10, 2)
  /// 运费
  freight        Decimal?       @db.Decimal(10, 2)
  /// 实付金额
  actualAmount   Decimal        @map("actual_amount") @db.Decimal(10, 2)
  /// 已付金额
  payAmount      Decimal?       @map("pay_amount") @db.Decimal(10, 2)
  /// 已退款金额
  refundAmount   Decimal?       @map("refund_amount") @db.Decimal(10, 2)
  /// 订单状态
  status         OrderStatus    @default(PENDING)
  /// 支付状态
  payStatus      PayStatus      @default(UNPAID) @map("pay_status")
  /// 发货状态
  shippingStatus ShippingStatus @default(NOT_SHIPPED) @map("shipping_status")
  /// 退款状态
  refundStatus   RefundStatus   @default(NONE) @map("refund_status")
  /// 支付方式
  paymentMethod  String?        @map("payment_method") @db.VarChar(50)
  /// 支付渠道
  paymentChannel String?        @map("payment_channel") @db.VarChar(50)
  /// 支付流水号
  paymentNo      String?        @map("payment_no") @db.VarChar(100)
  /// 退款流水号
  refundNo       String?        @map("refund_no") @db.VarChar(100)
  /// 支付时间
  paymentTime    DateTime?      @map("payment_time")
  /// 发货时间
  shippingTime   DateTime?      @map("shipping_time")
  /// 收货时间
  receivedTime   DateTime?      @map("received_time")
  /// 取消时间
  cancelTime     DateTime?      @map("cancel_time")
  /// 完成时间
  finishTime     DateTime?      @map("finish_time")
  /// 退款时间
  refundTime     DateTime?      @map("refund_time")
  /// 关闭时间
  closeTime      DateTime?      @map("close_time")
  /// 取消原因
  cancelReason   String?        @map("cancel_reason") @db.VarChar(200)
  /// 关闭原因
  closeReason    String?        @map("close_reason") @db.VarChar(200)
  /// 物流公司
  shippingCompany String?       @map("shipping_company") @db.VarChar(100)
  /// 运单号
  shippingNo     String?        @map("shipping_no") @db.VarChar(100)
  /// 配送方式
  shippingMethod String?        @map("shipping_method") @db.VarChar(50)
  /// 收货人
  receiver       String?        @db.VarChar(100)
  /// 收货电话
  phone          String?        @db.VarChar(20)
  /// 收货省份
  receiverProvince String?      @map("receiver_province") @db.VarChar(50)
  /// 收货城市
  receiverCity   String?        @map("receiver_city") @db.VarChar(50)
  /// 收货区县
  receiverDistrict String?      @map("receiver_district") @db.VarChar(50)
  /// 邮编
  receiverPostalCode String?    @map("receiver_postal_code") @db.VarChar(20)
  /// 收货地址
  address        String?
  /// 买家备注
  buyerRemark    String?        @map("buyer_remark") @db.VarChar(500)
  /// 卖家备注
  sellerRemark   String?        @map("seller_remark") @db.VarChar(500)
  /// 发票类型
  invoiceType    InvoiceType?   @map("invoice_type")
  /// 发票抬头类型
  invoiceTitleType InvoiceTitleType? @map("invoice_title_type")
  /// 发票抬头
  invoiceTitle   String?        @map("invoice_title") @db.VarChar(100)
  /// 发票税号
  invoiceTaxNo   String?        @map("invoice_tax_no") @db.VarChar(50)
  /// 发票内容
  invoiceContent String?        @map("invoice_content") @db.VarChar(200)
  /// 备注
  remark         String?        @db.VarChar(500)
  /// 创建者ID
  createdBy      String?        @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt      DateTime       @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy      String?        @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt      DateTime       @updatedAt @map("updated_at")
  /// 删除标记
  deleted        Boolean        @default(false) @map("deleted")
  /// 删除时间
  deletedAt      DateTime?      @map("deleted_at")
  member         Member?        @relation(fields: [memberId], references: [id])
  memberAddress  MemberAddress? @relation(fields: [memberAddressId], references: [id])
  orderItems     OrderItem[]
  payments       OrderPayment[]
  shipments      OrderShipment[]
  refunds        OrderRefund[]
  logs           OrderLog[]
  invoice        Invoice?
  afterSales     AfterSale[]

  @@index([memberId])
  @@index([memberAddressId])
  @@index([orderNo])
  @@index([status])
  @@index([payStatus])
  @@index([shippingStatus])
  @@index([refundStatus])
  @@map("mall_order")
}

/// 订单项表
model OrderItem {
  id             Int      @id @default(autoincrement())
  /// 订单ID
  orderId        Int      @map("order_id")
  /// 商品ID
  productId      Int?     @map("product_id")
  /// SKU ID
  skuId          Int?     @map("sku_id")
  /// 商品名称（下单快照）
  productName    String   @map("product_name") @db.VarChar(200)
  /// 商品主图
  productImage   String?  @map("product_image") @db.VarChar(500)
  /// SKU名称
  skuName        String?  @map("sku_name") @db.VarChar(200)
  /// SKU编码
  skuCode        String?  @map("sku_code") @db.VarChar(50)
  /// 规格快照
  specSnapshot   Json?    @map("spec_snapshot") @db.Json
  /// 成交单价
  price          Decimal  @db.Decimal(10, 2)
  /// 原价
  originalPrice  Decimal? @map("original_price") @db.Decimal(10, 2)
  /// 数量
  quantity       Int
  /// 小计金额
  totalAmount    Decimal  @map("total_amount") @db.Decimal(10, 2)
  /// 优惠金额
  discountAmount Decimal? @map("discount_amount") @db.Decimal(10, 2)
  /// 实付金额
  actualAmount   Decimal  @map("actual_amount") @db.Decimal(10, 2)
  /// 已退款金额
  refundAmount   Decimal? @map("refund_amount") @db.Decimal(10, 2)
  /// 退款状态
  refundStatus   RefundStatus @default(NONE) @map("refund_status")
  /// 已发货数量
  shippedQty     Int      @default(0) @map("shipped_qty")
  /// 已退货数量
  refundedQty    Int      @default(0) @map("refunded_qty")
  /// 商品重量
  weight         Decimal? @db.Decimal(8, 2)
  /// 备注
  remark         String?  @db.VarChar(500)
  /// 创建者ID
  createdBy      String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt      DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy      String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt      DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted        Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt      DateTime? @map("deleted_at")
  order          Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product        Product?  @relation(fields: [productId], references: [id])
  sku            ProductSKU? @relation(fields: [skuId], references: [id])
  refunds        OrderRefund[]
  afterSaleItems AfterSaleItem[]

  @@index([orderId])
  @@index([productId])
  @@index([skuId])
  @@index([refundStatus])
  @@index([deleted])
  @@map("mall_order_item")
}

/// 订单支付表
model OrderPayment {
  id            Int      @id @default(autoincrement())
  /// 订单ID
  orderId       Int      @map("order_id")
  /// 支付流水号
  paymentNo     String?  @map("payment_no") @db.VarChar(100)
  /// 支付渠道
  paymentChannel String? @map("payment_channel") @db.VarChar(50)
  /// 支付方式
  paymentMethod String?  @map("payment_method") @db.VarChar(50)
  /// 支付状态
  payStatus     PayStatus @default(UNPAID) @map("pay_status")
  /// 支付金额
  payAmount     Decimal  @map("pay_amount") @db.Decimal(10, 2)
  /// 支付时间
  payTime       DateTime? @map("pay_time")
  /// 第三方交易号
  tradeNo       String?  @map("trade_no") @db.VarChar(100)
  /// 支付响应
  payResponse   Json?    @map("pay_response") @db.Json
  /// 备注
  remark        String?  @db.VarChar(500)
  /// 创建者ID
  createdBy     String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt     DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy     String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt     DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted       Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt     DateTime? @map("deleted_at")
  order         Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([paymentNo])
  @@index([payStatus])
  @@map("mall_order_payment")
}

/// 订单发货表
model OrderShipment {
  id              Int            @id @default(autoincrement())
  /// 订单ID
  orderId         Int            @map("order_id")
  /// 物流公司
  shippingCompany String?        @map("shipping_company") @db.VarChar(100)
  /// 运单号
  shippingNo      String?        @map("shipping_no") @db.VarChar(100)
  /// 配送方式
  shippingMethod  String?        @map("shipping_method") @db.VarChar(50)
  /// 发货状态
  shippingStatus  ShippingStatus @default(NOT_SHIPPED) @map("shipping_status")
  /// 发货时间
  shippedTime     DateTime?      @map("shipped_time")
  /// 签收时间
  deliveredTime   DateTime?      @map("delivered_time")
  /// 收货人
  receiver        String?        @db.VarChar(100)
  /// 收货电话
  phone           String?        @db.VarChar(20)
  /// 收货地址
  address         String?
  /// 备注
  remark          String?        @db.VarChar(500)
  /// 创建者ID
  createdBy       String?        @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime       @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?        @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime       @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean        @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?      @map("deleted_at")
  order           Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([shippingNo])
  @@index([shippingStatus])
  @@map("mall_order_shipment")
}

/// 订单退款表
model OrderRefund {
  id            Int          @id @default(autoincrement())
  /// 订单ID
  orderId       Int          @map("order_id")
  /// 订单项ID（可为空）
  orderItemId   Int?         @map("order_item_id")
  /// 退款单号
  refundNo      String?      @map("refund_no") @db.VarChar(100)
  /// 退款状态
  refundStatus  RefundStatus @default(APPLYING) @map("refund_status")
  /// 退款金额
  refundAmount  Decimal      @map("refund_amount") @db.Decimal(10, 2)
  /// 退款原因
  refundReason  String?      @map("refund_reason") @db.VarChar(200)
  /// 退款方式
  refundMethod  String?      @map("refund_method") @db.VarChar(50)
  /// 申请时间
  applyTime     DateTime?    @map("apply_time")
  /// 审核时间
  auditTime     DateTime?    @map("audit_time")
  /// 退款时间
  refundTime    DateTime?    @map("refund_time")
  /// 备注
  remark        String?      @db.VarChar(500)
  /// 创建者ID
  createdBy     String?      @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt     DateTime     @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy     String?      @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt     DateTime     @updatedAt @map("updated_at")
  /// 删除标记
  deleted       Boolean      @default(false) @map("deleted")
  /// 删除时间
  deletedAt     DateTime?    @map("deleted_at")
  order         Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderItem     OrderItem?   @relation(fields: [orderItemId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([orderItemId])
  @@index([refundNo])
  @@index([refundStatus])
  @@map("mall_order_refund")
}

/// 订单操作日志
model OrderLog {
  id           Int      @id @default(autoincrement())
  /// 订单ID
  orderId      Int      @map("order_id")
  /// 操作动作
  action       String   @db.VarChar(100)
  /// 操作前状态
  fromStatus   String?  @map("from_status") @db.VarChar(50)
  /// 操作后状态
  toStatus     String?  @map("to_status") @db.VarChar(50)
  /// 操作人ID
  operatorId   String?  @map("operator_id") @db.VarChar(64)
  /// 操作人名称
  operatorName String?  @map("operator_name") @db.VarChar(100)
  /// 备注
  remark       String?  @db.VarChar(500)
  /// 创建时间
  createdAt    DateTime @default(now()) @map("created_at")
  order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@map("mall_order_log")
}

/// 订单发票表
model Invoice {
  id            Int           @id @default(autoincrement())
  /// 订单ID
  orderId       Int           @unique @map("order_id")
  /// 发票类型
  invoiceType   InvoiceType?  @map("invoice_type")
  /// 发票抬头类型
  invoiceTitleType InvoiceTitleType? @map("invoice_title_type")
  /// 发票抬头
  invoiceTitle  String?       @map("invoice_title") @db.VarChar(100)
  /// 发票税号
  invoiceTaxNo  String?       @map("invoice_tax_no") @db.VarChar(50)
  /// 发票内容
  invoiceContent String?      @map("invoice_content") @db.VarChar(200)
  /// 开票金额
  invoiceAmount Decimal?      @map("invoice_amount") @db.Decimal(10, 2)
  /// 发票状态
  invoiceStatus InvoiceStatus @default(APPLYING) @map("invoice_status")
  /// 申请时间
  applyTime     DateTime?     @map("apply_time")
  /// 开票时间
  issueTime     DateTime?     @map("issue_time")
  /// 备注
  remark        String?       @db.VarChar(500)
  /// 创建者ID
  createdBy     String?       @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt     DateTime      @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy     String?       @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt     DateTime      @updatedAt @map("updated_at")
  /// 删除标记
  deleted       Boolean       @default(false) @map("deleted")
  /// 删除时间
  deletedAt     DateTime?     @map("deleted_at")
  order         Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([invoiceStatus])
  @@map("mall_invoice")
}

/// 售后单
model AfterSale {
  id            Int             @id @default(autoincrement())
  /// 订单ID
  orderId       Int             @map("order_id")
  /// 售后单号
  afterSaleNo   String?         @map("after_sale_no") @db.VarChar(100)
  /// 售后类型
  type          AfterSaleType   @default(RETURN) @map("type")
  /// 售后状态
  status        AfterSaleStatus @default(APPLYING) @map("status")
  /// 售后原因
  reason        String?         @db.VarChar(200)
  /// 售后金额
  amount        Decimal?        @db.Decimal(10, 2)
  /// 申请时间
  applyTime     DateTime?       @map("apply_time")
  /// 审核时间
  auditTime     DateTime?       @map("audit_time")
  /// 完成时间
  finishTime    DateTime?       @map("finish_time")
  /// 备注
  remark        String?         @db.VarChar(500)
  /// 创建者ID
  createdBy     String?         @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt     DateTime        @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy     String?         @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt     DateTime        @updatedAt @map("updated_at")
  /// 删除标记
  deleted       Boolean         @default(false) @map("deleted")
  /// 删除时间
  deletedAt     DateTime?       @map("deleted_at")
  order         Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  items         AfterSaleItem[]
  logs          AfterSaleLog[]

  @@index([orderId])
  @@index([afterSaleNo])
  @@index([status])
  @@map("mall_after_sale")
}

/// 售后明细
model AfterSaleItem {
  id           Int         @id @default(autoincrement())
  /// 售后单ID
  afterSaleId  Int         @map("after_sale_id")
  /// 订单项ID
  orderItemId  Int?        @map("order_item_id")
  /// 商品ID
  productId    Int?        @map("product_id")
  /// SKU ID
  skuId        Int?        @map("sku_id")
  /// 商品名称快照
  productName  String?     @map("product_name") @db.VarChar(200)
  /// SKU名称快照
  skuName      String?     @map("sku_name") @db.VarChar(200)
  /// 单价快照
  price        Decimal?    @db.Decimal(10, 2)
  /// 数量
  quantity     Int         @default(1)
  /// 退款金额
  refundAmount Decimal?    @map("refund_amount") @db.Decimal(10, 2)
  /// 备注
  remark       String?     @db.VarChar(500)
  /// 创建者ID
  createdBy    String?     @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt    DateTime    @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy    String?     @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt    DateTime    @updatedAt @map("updated_at")
  /// 删除标记
  deleted      Boolean     @default(false) @map("deleted")
  /// 删除时间
  deletedAt    DateTime?   @map("deleted_at")
  afterSale    AfterSale   @relation(fields: [afterSaleId], references: [id], onDelete: Cascade)
  orderItem    OrderItem?  @relation(fields: [orderItemId], references: [id], onDelete: Cascade)
  product      Product?    @relation(fields: [productId], references: [id])
  sku          ProductSKU? @relation(fields: [skuId], references: [id])

  @@index([afterSaleId])
  @@index([orderItemId])
  @@index([productId])
  @@index([skuId])
  @@map("mall_after_sale_item")
}

/// 售后操作日志
model AfterSaleLog {
  id            Int       @id @default(autoincrement())
  /// 售后单ID
  afterSaleId   Int       @map("after_sale_id")
  /// 操作动作
  action        String    @db.VarChar(100)
  /// 操作前状态
  fromStatus    String?   @map("from_status") @db.VarChar(50)
  /// 操作后状态
  toStatus      String?   @map("to_status") @db.VarChar(50)
  /// 操作人ID
  operatorId    String?   @map("operator_id") @db.VarChar(64)
  /// 操作人名称
  operatorName  String?   @map("operator_name") @db.VarChar(100)
  /// 备注
  remark        String?   @db.VarChar(500)
  /// 创建时间
  createdAt     DateTime  @default(now()) @map("created_at")
  afterSale     AfterSale @relation(fields: [afterSaleId], references: [id], onDelete: Cascade)

  @@index([afterSaleId])
  @@map("mall_after_sale_log")
}

/// 商品管理表
model Product {
  id            Int                @id @default(autoincrement())
  /// 商品名称
  name          String             @db.VarChar(100)
  /// 商品编码
  code          String?            @db.VarChar(50)
  /// 分类ID
  categoryId    Int?               @map("category_id")
  /// 商品详情
  content       String?
  /// 默认原价
  originalPrice Decimal?           @map("original_price") @db.Decimal(10, 2)
  /// 总销量
  sales         Int                @default(0)
  /// 单位
  unit          String?            @db.VarChar(20)
  /// 排序
  sort          Int                @default(0)
  /// 销售状态
  status        ProductStatus      @default(DRAFT) @map("status")
  /// 备注
  remark        String?            @db.VarChar(500)
  /// 创建者ID
  createdBy     String?            @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt     DateTime           @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy     String?            @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt     DateTime           @updatedAt @map("updated_at")
  /// 删除标记
  deleted       Boolean            @default(false) @map("deleted")
  /// 删除时间
  deletedAt     DateTime?          @map("deleted_at")
  /// 默认现价
  defaultPrice  Decimal?           @map("default_price") @db.Decimal(10, 2)
  /// 默认库存
  defaultStock  Int                @default(0) @map("default_stock")
  /// 默认重量(kg)
  defaultWeight Decimal?           @map("default_weight") @db.Decimal(8, 2)
  /// 商品主图（单张）
  mainImage    String?            @map("main_image") @db.VarChar(500)
  /// 商品附图/轮播图列表
  images       Json?              @db.Json
  /// 商品规格信息
  specs         Json?              @db.Json
  category      Category?          @relation(fields: [categoryId], references: [id])
  skus          ProductSKU[]
  specGroups    ProductSpecGroup[]
  cartItems     CartItem[]
  orderItems    OrderItem[]
  afterSaleItems AfterSaleItem[]

  @@index([categoryId])
  @@index([status])
  @@map("mall_product")
}

model ProductSpecGroup {
  id         Int                @id @default(autoincrement())
  /// 商品ID
  productId  Int                @map("product_id")
  /// 规格组名称（如颜色、尺寸）
  name       String             @db.VarChar(50)
  /// 排序
  sort       Int                @default(0)
  /// 创建时间
  createdAt  DateTime           @default(now()) @map("created_at")
  /// 更新时间
  updatedAt  DateTime           @updatedAt @map("updated_at")
  /// 创建者ID
  createdBy  String?            @map("created_by") @db.VarChar(64)
  /// 更新者ID
  updatedBy  String?            @map("updated_by") @db.VarChar(64)
  /// 删除标记
  deleted    Boolean            @default(false) @map("deleted")
  /// 删除时间
  deletedAt  DateTime?          @map("deleted_at")
  product    Product            @relation(fields: [productId], references: [id], onDelete: Cascade)
  specValues ProductSpecValue[]

  @@index([productId])
  @@index([deleted])
  @@map("mall_product_spec_group")
}

model ProductSpecValue {
  id          Int              @id @default(autoincrement())
  /// 规格组ID
  specGroupId Int              @map("spec_group_id")
  /// 规格值名称（如红色、蓝色）
  name        String           @db.VarChar(50)
  /// 排序
  sort        Int              @default(0)
  /// 创建时间
  createdAt   DateTime         @default(now()) @map("created_at")
  /// 更新时间
  updatedAt   DateTime         @updatedAt @map("updated_at")
  /// 创建者ID
  createdBy   String?          @map("created_by") @db.VarChar(64)
  /// 更新者ID
  updatedBy   String?          @map("updated_by") @db.VarChar(64)
  /// 删除标记
  deleted     Boolean          @default(false) @map("deleted")
  /// 删除时间
  deletedAt   DateTime?        @map("deleted_at")
  specGroup   ProductSpecGroup @relation(fields: [specGroupId], references: [id], onDelete: Cascade)

  @@index([specGroupId])
  @@index([deleted])
  @@map("mall_product_spec_value")
}

model ProductSKU {
  id              Int      @id @default(autoincrement())
  /// 商品ID
  productId       Int      @map("product_id")
  /// SKU编码
  skuCode         String  @map("sku_code") @unique @db.VarChar(50)
  /// 规格组合 {"color": "红色", "size": "M"}
  specCombination Json     @map("spec_combination") @db.Json
  /// SKU价格
  price           Decimal  @db.Decimal(10, 2)
  /// 成本价
  costPrice       Decimal? @db.Decimal(10, 2) @map("cost_price")
  /// SKU库存
  stock           Int      @default(0)
  /// 低库存预警值
  lowStockAlert   Int      @default(10) @map("low_stock_alert")
  /// SKU重量(kg)
  weight          Decimal? @db.Decimal(8, 2)
  /// SKU销量
  sales           Int      @default(0)
  /// SKU图片列表
  images          Json?    @db.Json
  /// 创建时间
  createdAt       DateTime @default(now()) @map("created_at")
  /// 更新时间
  updatedAt       DateTime @updatedAt @map("updated_at")
  /// 创建者ID
  createdBy       String?   @map("created_by") @db.VarChar(64)
  /// 更新者ID
  updatedBy       String?   @map("updated_by") @db.VarChar(64)
  /// 删除标记
  deleted         Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime? @map("deleted_at")
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockLogs       ProductStockLog[]
  cartItems       CartItem[]
  orderItems      OrderItem[]
  afterSaleItems  AfterSaleItem[]

  @@index([productId, skuCode])
  @@index([productId, price, stock])
  @@index([sales])
  @@index([deleted])
  @@index([stock, lowStockAlert])
  @@map("mall_product_sku")
}

/// 购物车表
model Cart {
  id         Int      @id @default(autoincrement())
  /// 会员ID
  memberId   Int      @map("member_id")
  /// 备注
  remark     String?  @db.VarChar(500)
  /// 创建者ID
  createdBy  String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt  DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy  String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt  DateTime? @updatedAt @map("updated_at")
  /// 删除标记
  deleted    Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt  DateTime? @map("deleted_at")
  member     Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  items      CartItem[]

  @@index([memberId])
  @@index([deleted])
  @@map("mall_cart")
}

/// 购物车项表
model CartItem {
  id           Int      @id @default(autoincrement())
  /// 购物车ID
  cartId       Int      @map("cart_id")
  /// 会员ID
  memberId     Int      @map("member_id")
  /// 商品ID
  productId    Int?     @map("product_id")
  /// SKU ID
  skuId        Int?     @map("sku_id")
  /// 商品名称快照
  productName  String?  @map("product_name") @db.VarChar(200)
  /// SKU名称快照
  skuName      String?  @map("sku_name") @db.VarChar(200)
  /// SKU编码快照
  skuCode      String?  @map("sku_code") @db.VarChar(50)
  /// 规格快照
  specSnapshot Json?    @map("spec_snapshot") @db.Json
  /// 单价快照
  price        Decimal? @db.Decimal(10, 2)
  /// 数量
  quantity     Int      @default(1)
  /// 是否选中
  checked      Boolean  @default(true)
  /// 备注
  remark       String?  @db.VarChar(500)
  /// 创建者ID
  createdBy    String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt    DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy    String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt    DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted      Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt    DateTime? @map("deleted_at")
  cart         Cart      @relation(fields: [cartId], references: [id], onDelete: Cascade)
  member       Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  product      Product?  @relation(fields: [productId], references: [id])
  sku          ProductSKU? @relation(fields: [skuId], references: [id])

  @@index([cartId])
  @@index([memberId])
  @@index([productId])
  @@index([skuId])
  @@index([deleted])
  @@map("mall_cart_item")
}

model ProductStockLog {
  id          Int      @id @default(autoincrement())
  /// SKU ID
  skuId       Int      @map("sku_id")
  /// 库存变动类型
  type        StockChangeType
  /// 变动数量（正数为增加，负数为减少）
  quantity    Int
  /// 变动前库存
  beforeStock Int      @map("before_stock")
  /// 变动后库存
  afterStock  Int      @map("after_stock")
  /// 关联订单ID（可选）
  orderId     String?  @map("order_id") @db.VarChar(64)
  /// 备注
  remark      String?  @db.VarChar(255)
  
  /// 创建时间
  createdAt       DateTime @default(now()) @map("created_at")
  /// 更新时间
  updatedAt       DateTime @updatedAt @map("updated_at")
  /// 创建者ID
  createdBy       String?   @map("created_by") @db.VarChar(64)
  /// 更新者ID
  updatedBy       String?   @map("updated_by") @db.VarChar(64)
  /// 删除标记
  deleted         Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime? @map("deleted_at")
 
  sku ProductSKU @relation(fields: [skuId], references: [id])

  @@index([skuId, createdAt])
  @@index([orderId])
  @@map("mall_product_stock_log")
}

model SysJob {
  id         Int        @id @default(autoincrement())
  name       String     @db.VarChar(100)
  type       JobType    @default(SYSTEM)
  handler    String     @db.VarChar(100)
  httpMethod String?    @map("http_method") @db.VarChar(10)
  httpUrl    String?    @map("http_url") @db.VarChar(500)
  httpHeaders Json?     @map("http_headers")
  cron       String     @db.VarChar(100)
  payload    Json?
  status     Status     @default(ENABLED)
  remark     String?    @db.VarChar(500)
  lastRunAt  DateTime?  @map("last_run_at")
  createdBy  String?    @map("created_by") @db.VarChar(64)
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedBy  String?    @map("updated_by") @db.VarChar(64)
  updatedAt  DateTime   @updatedAt @map("updated_at")
  deleted    Boolean    @default(false)
  deletedAt  DateTime?  @map("deleted_at")
  logs       SysJobLog[]

  @@index([status, deleted])
  @@map("sys_job")
}

model SysJobLog {
  id         Int      @id @default(autoincrement())
  jobId      Int      @map("job_id")
  jobName    String   @map("job_name") @db.VarChar(100)
  handler    String   @db.VarChar(100)
  trigger    String   @db.VarChar(20)
  status     String   @db.VarChar(20)
  message    String?  @db.VarChar(500)
  error      String?  @db.VarChar(1000)
  payload    Json?    @map("payload")
  startedAt  DateTime @map("started_at")
  finishedAt DateTime? @map("finished_at")
  durationMs Int?     @map("duration_ms")
  result     Json?
  createdBy  String?  @map("created_by") @db.VarChar(64)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedBy  String?  @map("updated_by") @db.VarChar(64)
  updatedAt  DateTime? @updatedAt @map("updated_at")
  deleted    Boolean  @default(false)
  deletedAt  DateTime? @map("deleted_at")
  job        SysJob   @relation(fields: [jobId], references: [id])

  @@index([jobId, startedAt])
  @@index([deleted])
  @@map("sys_job_log")
}

model SysConfig {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(100)
  key        String    @db.VarChar(100)
  value      String    @db.VarChar(500)
  configType String    @default("N") @map("config_type") @db.Char(1)
  remark     String?   @db.VarChar(500)
  createdBy  String?   @map("created_by") @db.VarChar(64)
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedBy  String?   @map("updated_by") @db.VarChar(64)
  updatedAt  DateTime  @updatedAt @map("updated_at")
  deleted    Boolean   @default(false)
  deletedAt  DateTime? @map("deleted_at")

  @@unique([key, deleted])
  @@index([deleted])
  @@map("sys_config")
}

model SysNotice {
  id            Int       @id @default(autoincrement())
  title         String    @db.VarChar(50)
  noticeType    String    @map("notice_type") @db.Char(1)
  noticeContent String?   @map("notice_content")
  status        Status    @default(ENABLED)
  createdBy     String?   @map("created_by") @db.VarChar(64)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedBy     String?   @map("updated_by") @db.VarChar(64)
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deleted       Boolean   @default(false)
  deletedAt     DateTime? @map("deleted_at")

  @@index([deleted])
  @@map("sys_notice")
}

model SysDictType {
  id        Int           @id @default(autoincrement())
  name      String        @db.VarChar(100)
  type      String        @unique @db.VarChar(100)
  status    Status        @default(ENABLED)
  remark    String?       @db.VarChar(500)
  createdBy String?       @map("created_by") @db.VarChar(64)
  createdAt DateTime      @default(now()) @map("created_at")
  updatedBy String?       @map("updated_by") @db.VarChar(64)
  updatedAt DateTime      @updatedAt @map("updated_at")
  deleted   Boolean       @default(false)
  deletedAt DateTime?     @map("deleted_at")
  data      SysDictData[]

  @@index([deleted])
  @@map("sys_dict_type")
}

model SysDictData {
  id        Int         @id @default(autoincrement())
  dictType  String      @map("dict_type") @db.VarChar(100)
  label     String      @db.VarChar(100)
  value     String      @db.VarChar(100)
  sort      Int         @default(0)
  cssClass  String?     @map("css_class") @db.VarChar(100)
  listClass String?     @map("list_class") @db.VarChar(100)
  isDefault Boolean     @default(false) @map("is_default")
  status    Status      @default(ENABLED)
  remark    String?     @db.VarChar(500)
  createdBy String?     @map("created_by") @db.VarChar(64)
  createdAt DateTime    @default(now()) @map("created_at")
  updatedBy String?     @map("updated_by") @db.VarChar(64)
  updatedAt DateTime    @updatedAt @map("updated_at")
  deleted   Boolean     @default(false)
  deletedAt DateTime?   @map("deleted_at")
  type      SysDictType @relation(fields: [dictType], references: [type])

  @@index([dictType])
  @@index([deleted])
  @@map("sys_dict_data")
}

model SysOperLog {
  id            Int      @id @default(autoincrement())
  title         String?  @db.VarChar(50)
  businessType  Int      @default(0) @map("business_type")
  method        String?  @db.VarChar(100)
  requestMethod String?  @map("request_method") @db.VarChar(10)
  operatorType  Int      @default(0) @map("operator_type")
  operName      String?  @map("oper_name") @db.VarChar(50)
  deptName      String?  @map("dept_name") @db.VarChar(50)
  operUrl       String?  @map("oper_url") @db.VarChar(255)
  operIp        String?  @map("oper_ip") @db.VarChar(128)
  operLocation  String?  @map("oper_location") @db.VarChar(255)
  operParam     String?  @map("oper_param")
  jsonResult    String?  @map("json_result")
  status        Int      @default(0)
  errorMsg      String?  @map("error_msg")
  operTime      DateTime @default(now()) @map("oper_time")
  costTime      Int      @default(0) @map("cost_time")

  @@index([operTime])
  @@index([businessType])
  @@map("sys_oper_log")
}

model SysLoginLog {
  id        Int      @id @default(autoincrement())
  username  String?  @db.VarChar(50)
  ipaddr    String?  @db.VarChar(128)
  location  String?  @db.VarChar(255)
  browser   String?  @db.VarChar(50)
  os        String?  @db.VarChar(50)
  status    String   @default("0") @db.Char(1)
  msg       String?  @db.VarChar(255)
  loginTime DateTime @default(now()) @map("login_time")

  @@index([loginTime])
  @@index([username])
  @@map("sys_login_log")
}

/// 告警规则
model SysAlertRule {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  /// 规则类型: CPU, MEMORY, DISK, API_ERROR_RATE, API_RESPONSE_TIME, LOGIN_FAIL, DB_CONNECTION
  type        String   @db.VarChar(50)
  /// 触发条件: GT(大于), LT(小于), EQ(等于), GTE(大于等于), LTE(小于等于)
  condition   String   @db.VarChar(10)
  /// 阈值
  threshold   Float
  /// 告警级别: INFO, WARNING, ERROR, CRITICAL
  level       String   @default("WARNING") @db.VarChar(20)
  /// 通知方式: EMAIL, SMS, WEBHOOK (逗号分隔)
  notifyType  String?  @map("notify_type") @db.VarChar(100)
  /// Webhook URL
  webhookUrl  String?  @map("webhook_url") @db.VarChar(500)
  /// 邮件接收人 (逗号分隔)
  emailTo     String?  @map("email_to") @db.VarChar(500)
  /// 是否启用
  enabled     Boolean  @default(true)
  /// 静默时间（分钟）：同一规则触发后多久内不再告警
  silenceMins Int      @default(5) @map("silence_mins")
  /// 最后触发时间
  lastTriggeredAt DateTime? @map("last_triggered_at")
  /// 备注
  remark      String?  @db.VarChar(500)
  /// 创建者ID
  createdBy   String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt   DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy   String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt   DateTime @updatedAt @map("updated_at")
  /// 删除标记
  deleted     Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt   DateTime? @map("deleted_at")

  alerts      SysAlert[]

  @@index([type])
  @@index([enabled])
  @@index([deleted])
  @@map("sys_alert_rule")
}

/// 告警事件
model SysAlert {
  id          Int      @id @default(autoincrement())
  ruleId      Int      @map("rule_id")
  /// 告警级别
  level       String   @db.VarChar(20)
  /// 告警标题
  title       String   @db.VarChar(200)
  /// 告警内容
  content     String   @db.Text
  /// 当前值
  currentValue Float   @map("current_value")
  /// 阈值
  threshold   Float
  /// 状态: PENDING(待处理), ACKNOWLEDGED(已确认), RESOLVED(已解决)
  status      String   @default("PENDING") @db.VarChar(20)
  /// 处理人
  handledBy   String?  @map("handled_by") @db.VarChar(50)
  /// 处理时间
  handledAt   DateTime? @map("handled_at")
  /// 处理备注
  handleRemark String? @map("handle_remark") @db.VarChar(500)
  /// 创建者ID
  createdBy   String?  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt   DateTime @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy   String?  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt   DateTime? @updatedAt @map("updated_at")
  /// 删除标记
  deleted     Boolean  @default(false) @map("deleted")
  /// 删除时间
  deletedAt   DateTime? @map("deleted_at")

  rule        SysAlertRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([ruleId])
  @@index([status])
  @@index([level])
  @@index([createdAt])
  @@index([deleted])
  @@map("sys_alert")
}

enum Status {
  ENABLED
  DISABLED
}

enum JobType {
  SYSTEM
  HTTP
}

enum Gender {
  MALE
  FEMALE
  UNKNOWN
}

enum MenuType {
  DIR
  MENU
  BUTTON
}

enum DataScope {
  ALL
  CUSTOM
  DEPT
  DEPT_BELOW
  SELF
}

/// 订单状态枚举
enum OrderStatus {
  /// 待付款
  PENDING   @map("pending")
  /// 已付款
  PAID      @map("paid")
  /// 已发货
  SHIPPED   @map("shipped")
  /// 已送达
  DELIVERED @map("delivered")
  /// 已完成
  COMPLETED @map("completed")
  /// 已取消
  CANCELLED @map("cancelled")
  /// 退款中
  REFUNDING @map("refunding")
  /// 已退款
  REFUNDED  @map("refunded")
}

/// 支付状态枚举
enum PayStatus {
  /// 未支付
  UNPAID    @map("unpaid")
  /// 已支付
  PAID      @map("paid")
  /// 退款中
  REFUNDING @map("refunding")
  /// 已退款
  REFUNDED  @map("refunded")
}

/// 发货状态枚举
enum ShippingStatus {
  /// 未发货
  NOT_SHIPPED @map("not_shipped")
  /// 已发货
  SHIPPED     @map("shipped")
  /// 已送达
  DELIVERED   @map("delivered")
}

/// 退款状态枚举
enum RefundStatus {
  /// 无退款
  NONE      @map("none")
  /// 退款申请中
  APPLYING  @map("applying")
  /// 已同意
  APPROVED  @map("approved")
  /// 已拒绝
  REJECTED  @map("rejected")
  /// 退款中
  REFUNDING @map("refunding")
  /// 已退款
  REFUNDED  @map("refunded")
}

/// 发票类型枚举
enum InvoiceType {
  /// 电子普票
  ELECTRONIC @map("electronic")
  /// 纸质普票
  PAPER      @map("paper")
  /// 增值税专票
  VAT_SPECIAL @map("vat_special")
}

/// 发票抬头类型枚举
enum InvoiceTitleType {
  /// 个人
  PERSONAL @map("personal")
  /// 企业
  COMPANY  @map("company")
}

/// 余额变动类型枚举
enum BalanceChangeType {
  /// 充值
  RECHARGE @map("recharge")
  /// 消费
  CONSUME  @map("consume")
  /// 退款
  REFUND   @map("refund")
  /// 调整
  ADJUST   @map("adjust")
}

/// 积分变动类型枚举
enum PointChangeType {
  /// 获取
  EARN   @map("earn")
  /// 使用
  USE    @map("use")
  /// 退款
  REFUND @map("refund")
  /// 调整
  ADJUST @map("adjust")
}

/// 库存变动类型枚举
enum StockChangeType {
  /// 入库
  IN     @map("in")
  /// 出库
  OUT    @map("out")
  /// 订单
  ORDER  @map("order")
  /// 退款
  REFUND @map("refund")
  /// 手动调整
  MANUAL @map("manual")
}

/// 发票状态枚举
enum InvoiceStatus {
  /// 申请中
  APPLYING @map("applying")
  /// 已开票
  ISSUED   @map("issued")
  /// 已作废
  VOIDED   @map("voided")
}

/// 售后类型枚举
enum AfterSaleType {
  /// 退货
  RETURN  @map("return")
  /// 换货
  EXCHANGE @map("exchange")
  /// 维修
  REPAIR  @map("repair")
}

/// 售后状态枚举
enum AfterSaleStatus {
  /// 申请中
  APPLYING   @map("applying")
  /// 已同意
  APPROVED   @map("approved")
  /// 已拒绝
  REJECTED   @map("rejected")
  /// 处理中
  PROCESSING @map("processing")
  /// 已完成
  COMPLETED  @map("completed")
  /// 已关闭
  CLOSED     @map("closed")
}

/// 商品销售状态枚举
enum ProductStatus {
  /// 上架
  ON_SHELF  @map("on_shelf")
  /// 下架
  OFF_SHELF @map("off_shelf")
  /// 草稿
  DRAFT     @map("draft")
}

// ================================
// 工作流审批系统模型
// ================================

/// 流程分类表
model WfCategory {
  id          Int               @id @default(autoincrement())
  /// 分类编码（唯一标识）
  code        String            @db.VarChar(50)
  /// 分类名称
  name        String            @db.VarChar(100)
  /// 分类图标
  icon        String?           @db.VarChar(100)
  /// 分类颜色
  color       String?           @db.VarChar(20)
  /// 排序号
  sort        Int               @default(0)
  /// 状态
  status      WfCategoryStatus  @default(ENABLED)
  /// 父分类ID
  parentId    Int?              @map("parent_id")
  /// 层级（0-根级，1-一级子分类，以此类推）
  level       Int               @default(0)
  /// 备注
  remark      String?           @db.VarChar(500)
  /// 创建者ID
  createdBy   String?           @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt   DateTime          @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy   String?           @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt   DateTime          @updatedAt @map("updated_at")
  /// 删除标记
  deleted     Boolean           @default(false) @map("deleted")
  /// 删除时间
  deletedAt   DateTime?         @map("deleted_at")

  /// 父分类
  parent       WfCategory?       @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  /// 子分类
  children     WfCategory[]      @relation("CategoryHierarchy")
  /// 关联的流程定义
  flowDefinitions WfFlowDefinition[]

  @@index([parentId])
  @@index([code])
  @@index([status])
  @@index([sort])
  @@map("wf_category")
}

/// 流程定义表
model WfFlowDefinition {
  id            Int           @id @default(autoincrement())
  /// 流程编码（唯一标识）
  code          String        @db.VarChar(50)
  /// 流程名称
  name          String        @db.VarChar(100)
  /// 流程分类ID
  categoryId    Int?          @map("category_id")
  /// 流程分类关联
  category      WfCategory?   @relation(fields: [categoryId], references: [id])
  /// 版本号
  version       Int           @default(1)
  /// 流程图数据（nodes + edges）
  flowData      Json?         @map("flow_data") @db.Json
  /// 表单配置数据
  formData      Json?         @map("form_data") @db.Json
  /// 流程状态
  status        WfFlowStatus  @default(DRAFT)
  /// 是否为主版本（同一code只能有一个主版本）
  isMain        Boolean       @default(false) @map("is_main")
  /// 关联业务表名（可选）
  businessTable String?       @map("business_table") @db.VarChar(100)
  /// 流程描述
  description   String?       @db.VarChar(500)
  /// 备注
  remark        String?       @db.VarChar(500)
  /// 创建者ID
  createdBy     String?       @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt     DateTime      @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy     String?       @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt     DateTime      @updatedAt @map("updated_at")
  /// 删除标记
  deleted       Boolean       @default(false) @map("deleted")
  /// 删除时间
  deletedAt     DateTime?     @map("deleted_at")
  /// 节点配置
  nodeConfigs   WfNodeConfig[]
  /// 流程实例
  instances     WfFlowInstance[]

  @@unique([code, version, deletedAt])
  @@index([code])
  @@index([categoryId])
  @@index([status])
  @@index([isMain])
  @@index([deleted])
  @@map("wf_flow_definition")
}

/// 节点配置表
model WfNodeConfig {
  id                 Int                   @id @default(autoincrement())
  /// 流程定义ID
  flowDefinitionId   Int                   @map("flow_definition_id")
  /// 节点ID（流程图中的节点ID）
  nodeId             String                @map("node_id") @db.VarChar(50)
  /// 节点类型
  nodeType           WfNodeType            @map("node_type")
  /// 节点名称
  nodeName           String                @map("node_name") @db.VarChar(100)
  /// 审批方式（审批节点专用）
  approvalType       WfApprovalType?       @map("approval_type")
  /// 审批人选择方式
  assigneeType       WfAssigneeType?       @map("assignee_type")
  /// 审批人配置（roleIds/userIds/deptLevel/fieldName等）
  assigneeConfig     Json?                 @map("assignee_config") @db.Json
  /// 审批人为空时的处理策略
  emptyAssigneeAction WfEmptyAssigneeAction? @default(ERROR) @map("empty_assignee_action")
  /// 条件表达式（条件节点专用）
  conditionExpr      Json?                 @map("condition_expr") @db.Json
  /// 表单字段权限配置
  formPerms          Json?                 @map("form_perms") @db.Json
  /// 超时时间（分钟）
  timeLimit          Int?                  @map("time_limit")
  /// 超时处理方式
  timeoutAction      WfTimeoutAction?      @map("timeout_action")
  /// 抄送人配置
  ccConfig           Json?                 @map("cc_config") @db.Json
  /// 备注
  remark             String?               @db.VarChar(500)
  /// 创建者ID
  createdBy          String?               @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt          DateTime              @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy          String?               @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt          DateTime              @updatedAt @map("updated_at")
  /// 删除标记
  deleted            Boolean               @default(false) @map("deleted")
  /// 删除时间
  deletedAt          DateTime?             @map("deleted_at")
  /// 流程定义
  flowDefinition     WfFlowDefinition      @relation(fields: [flowDefinitionId], references: [id], onDelete: Cascade)

  @@unique([flowDefinitionId, nodeId, deletedAt])
  @@index([flowDefinitionId])
  @@index([nodeId])
  @@index([nodeType])
  @@index([deleted])
  @@map("wf_node_config")
}

/// 流程实例表
model WfFlowInstance {
  id                 Int               @id @default(autoincrement())
  /// 实例编号（唯一）
  instanceNo         String            @unique @map("instance_no") @db.VarChar(50)
  /// 流程定义ID
  flowDefinitionId   Int               @map("flow_definition_id")
  /// 流程标题
  title              String            @db.VarChar(200)
  /// 关联业务ID（可选）
  businessId         String?           @map("business_id") @db.VarChar(64)
  /// 关联业务编号
  businessNo         String?           @map("business_no") @db.VarChar(100)
  /// 关联业务表名
  businessTable      String?           @map("business_table") @db.VarChar(100)
  /// 表单数据快照
  formDataSnapshot   Json?             @map("form_data_snapshot") @db.Json
  /// 流程状态
  status             WfInstanceStatus  @default(RUNNING)
  /// 发起人ID
  initiatorId        Int               @map("initiator_id")
  /// 发起人姓名
  initiatorName      String?           @map("initiator_name") @db.VarChar(50)
  /// 发起人部门ID
  initiatorDeptId    Int?              @map("initiator_dept_id")
  /// 发起人部门名称
  initiatorDeptName  String?           @map("initiator_dept_name") @db.VarChar(100)
  /// 当前节点ID列表（JSON数组，支持并行多节点）
  currentNodeIds     Json?             @map("current_node_ids") @db.Json
  /// 流程变量（运行时数据）
  variables          Json?             @db.Json
  /// 流程开始时间
  startTime          DateTime          @default(now()) @map("start_time")
  /// 流程结束时间
  endTime            DateTime?         @map("end_time")
  /// 流程耗时（秒）
  duration           Int?
  /// 结果备注（完成/驳回/撤回原因）
  resultRemark       String?           @map("result_remark") @db.VarChar(500)
  /// 备注
  remark             String?           @db.VarChar(500)
  /// 创建者ID
  createdBy          String?           @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt          DateTime          @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy          String?           @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt          DateTime          @updatedAt @map("updated_at")
  /// 删除标记
  deleted            Boolean           @default(false) @map("deleted")
  /// 删除时间
  deletedAt          DateTime?         @map("deleted_at")
  /// 流程定义
  flowDefinition     WfFlowDefinition  @relation(fields: [flowDefinitionId], references: [id])
  /// 审批任务
  tasks              WfTask[]
  /// 流程日志
  logs               WfFlowLog[]
  /// 抄送记录
  copyRecords        WfCopyRecord[]

  @@index([instanceNo])
  @@index([flowDefinitionId])
  @@index([initiatorId])
  @@index([initiatorDeptId])
  @@index([status])
  @@index([businessId])
  @@index([businessTable])
  @@index([startTime])
  @@index([deleted])
  @@map("wf_flow_instance")
}

/// 审批任务表
model WfTask {
  id               Int             @id @default(autoincrement())
  /// 任务编号（唯一）
  taskNo           String          @unique @map("task_no") @db.VarChar(50)
  /// 流程实例ID
  flowInstanceId   Int             @map("flow_instance_id")
  /// 节点ID
  nodeId           String          @map("node_id") @db.VarChar(50)
  /// 节点名称
  nodeName         String          @map("node_name") @db.VarChar(100)
  /// 节点类型
  nodeType         WfNodeType      @map("node_type")
  /// 任务状态
  status           WfTaskStatus    @default(PENDING)
  /// 审批人ID
  assigneeId       Int?            @map("assignee_id")
  /// 审批人姓名
  assigneeName     String?         @map("assignee_name") @db.VarChar(50)
  /// 审批人部门ID
  assigneeDeptId   Int?            @map("assignee_dept_id")
  /// 审批人部门名称
  assigneeDeptName String?         @map("assignee_dept_name") @db.VarChar(100)
  /// 审批结果
  result           WfTaskResult?
  /// 审批意见
  comment          String?         @db.VarChar(500)
  /// 表单数据（审批时可修改的字段）
  formData         Json?           @map("form_data") @db.Json
  /// 任务开始时间
  startTime        DateTime        @default(now()) @map("start_time")
  /// 任务完成时间
  completedTime    DateTime?       @map("completed_time")
  /// 截止时间
  dueTime          DateTime?       @map("due_time")
  /// 任务耗时（秒）
  duration         Int?
  /// 是否超时
  isTimeout        Boolean         @default(false) @map("is_timeout")
  /// 转办/加签来源任务ID
  sourceTaskId     Int?            @map("source_task_id")
  /// 备注
  remark           String?         @db.VarChar(500)
  /// 创建者ID
  createdBy        String?         @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt        DateTime        @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy        String?         @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt        DateTime        @updatedAt @map("updated_at")
  /// 删除标记
  deleted          Boolean         @default(false) @map("deleted")
  /// 删除时间
  deletedAt        DateTime?       @map("deleted_at")
  /// 流程实例
  flowInstance     WfFlowInstance  @relation(fields: [flowInstanceId], references: [id], onDelete: Cascade)
  /// 流程日志
  logs             WfFlowLog[]
  /// 抄送记录
  copyRecords      WfCopyRecord[]

  @@index([taskNo])
  @@index([flowInstanceId])
  @@index([nodeId])
  @@index([assigneeId])
  @@index([status])
  @@index([result])
  @@index([startTime])
  @@index([dueTime])
  @@index([deleted])
  @@map("wf_task")
}

/// 流程操作日志表
model WfFlowLog {
  id               Int             @id @default(autoincrement())
  /// 流程实例ID
  flowInstanceId   Int             @map("flow_instance_id")
  /// 任务ID（可选）
  taskId           Int?            @map("task_id")
  /// 节点ID
  nodeId           String?         @map("node_id") @db.VarChar(50)
  /// 节点名称
  nodeName         String?         @map("node_name") @db.VarChar(100)
  /// 操作类型
  action           WfLogAction
  /// 操作前状态
  fromStatus       String?         @map("from_status") @db.VarChar(50)
  /// 操作后状态
  toStatus         String?         @map("to_status") @db.VarChar(50)
  /// 操作人ID
  operatorId       Int?            @map("operator_id")
  /// 操作人姓名
  operatorName     String?         @map("operator_name") @db.VarChar(50)
  /// 操作意见/备注
  comment          String?         @db.VarChar(500)
  /// 详细信息（JSON）
  detail           Json?           @db.Json
  /// 创建时间
  createdAt        DateTime        @default(now()) @map("created_at")
  /// 流程实例
  flowInstance     WfFlowInstance  @relation(fields: [flowInstanceId], references: [id], onDelete: Cascade)
  /// 任务
  task             WfTask?         @relation(fields: [taskId], references: [id], onDelete: SetNull)

  @@index([flowInstanceId])
  @@index([taskId])
  @@index([action])
  @@index([operatorId])
  @@index([createdAt])
  @@map("wf_flow_log")
}

/// 抄送记录表
model WfCopyRecord {
  id               Int             @id @default(autoincrement())
  /// 流程实例ID
  flowInstanceId   Int             @map("flow_instance_id")
  /// 任务ID（产生抄送的任务）
  taskId           Int?            @map("task_id")
  /// 接收人ID
  userId           Int             @map("user_id")
  /// 接收人姓名
  userName         String?         @map("user_name") @db.VarChar(50)
  /// 是否已读
  isRead           Boolean         @default(false) @map("is_read")
  /// 阅读时间
  readTime         DateTime?       @map("read_time")
  /// 创建时间
  createdAt        DateTime        @default(now()) @map("created_at")
  /// 流程实例
  flowInstance     WfFlowInstance  @relation(fields: [flowInstanceId], references: [id], onDelete: Cascade)
  /// 任务
  task             WfTask?         @relation(fields: [taskId], references: [id], onDelete: SetNull)

  @@index([flowInstanceId])
  @@index([taskId])
  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("wf_copy_record")
}

// ================================
// 工作流相关枚举
// ================================

/// 分类状态
enum WfCategoryStatus {
  /// 启用
  ENABLED  @map("enabled")
  /// 禁用
  DISABLED @map("disabled")
}

/// 流程定义状态
enum WfFlowStatus {
  /// 草稿
  DRAFT     @map("draft")
  /// 已发布
  PUBLISHED @map("published")
  /// 已停用
  DISABLED  @map("disabled")
}

/// 节点类型
enum WfNodeType {
  /// 开始节点
  START     @map("start")
  /// 结束节点
  END       @map("end")
  /// 审批节点
  APPROVAL  @map("approval")
  /// 条件分支
  CONDITION @map("condition")
  /// 并行网关
  PARALLEL  @map("parallel")
  /// 汇聚网关
  JOIN      @map("join")
}

/// 审批方式
enum WfApprovalType {
  /// 或签（任一人通过即可）
  OR_SIGN   @map("or_sign")
  /// 会签（所有人必须通过）
  AND_SIGN  @map("and_sign")
}

/// 审批人选择方式
enum WfAssigneeType {
  /// 按角色
  ROLE              @map("role")
  /// 部门领导
  DEPT_LEADER       @map("dept_leader")
  /// 指定人员
  SPECIFIC_USER     @map("specific_user")
  /// 发起人上级
  INITIATOR_LEADER  @map("initiator_leader")
  /// 表单字段
  FORM_FIELD        @map("form_field")
}

/// 审批人为空时的处理策略
enum WfEmptyAssigneeAction {
  /// 跳过该节点
  SKIP      @map("skip")
  /// 转给管理员
  TO_ADMIN  @map("to_admin")
  /// 报错终止
  ERROR     @map("error")
}

/// 超时处理方式
enum WfTimeoutAction {
  /// 自动通过
  AUTO_PASS   @map("auto_pass")
  /// 自动驳回
  AUTO_REJECT @map("auto_reject")
  /// 仅提醒
  REMIND      @map("remind")
}

/// 流程实例状态
enum WfInstanceStatus {
  /// 进行中
  RUNNING    @map("running")
  /// 已完成
  COMPLETED  @map("completed")
  /// 已驳回
  REJECTED   @map("rejected")
  /// 已撤回
  CANCELLED  @map("cancelled")
  /// 已终止
  TERMINATED @map("terminated")
}

/// 任务状态
enum WfTaskStatus {
  /// 待处理
  PENDING       @map("pending")
  /// 已完成
  COMPLETED     @map("completed")
  /// 已取消
  CANCELLED     @map("cancelled")
  /// 已转办
  TRANSFERRED   @map("transferred")
  /// 已加签
  COUNTERSIGNED @map("countersigned")
}

/// 任务结果
enum WfTaskResult {
  /// 通过
  APPROVED      @map("approved")
  /// 驳回
  REJECTED      @map("rejected")
  /// 转办
  TRANSFERRED   @map("transferred")
  /// 加签
  COUNTERSIGNED @map("countersigned")
}

/// 操作日志类型
enum WfLogAction {
  /// 发起
  START       @map("start")
  /// 通过
  APPROVE     @map("approve")
  /// 驳回
  REJECT      @map("reject")
  /// 转办
  TRANSFER    @map("transfer")
  /// 加签
  COUNTERSIGN @map("countersign")
  /// 撤回
  CANCEL      @map("cancel")
  /// 催办
  URGE        @map("urge")
  /// 终止
  TERMINATE   @map("terminate")
  /// 自动处理
  AUTO        @map("auto")
}

// ================================
// 营销管理系统模型
// ================================

/// 优惠券类型
enum CouponType {
  /// 满减券
  FULL_REDUCTION @map("full_reduction")
  /// 折扣券
  DISCOUNT       @map("discount")
  /// 无门槛券
  NO_THRESHOLD   @map("no_threshold")
}

/// 优惠券有效期类型
enum CouponValidType {
  /// 固定时间段
  FIXED  @map("fixed")
  /// 领取后N天
  DAYS   @map("days")
}

/// 优惠券适用范围类型
enum CouponScopeType {
  /// 全场通用
  ALL       @map("all")
  /// 指定分类
  CATEGORY  @map("category")
  /// 指定商品
  PRODUCT   @map("product")
}

/// 优惠券来源类型
enum CouponSource {
  /// 用户领取
  USER_CLAIM   @map("user_claim")
  /// 系统发放
  SYSTEM_GRANT @map("system_grant")
  /// 注册赠送
  REGISTER     @map("register")
  /// 首单赠送
  FIRST_ORDER  @map("first_order")
  /// 活动赠送
  ACTIVITY     @map("activity")
}

/// 用户优惠券状态
enum MemberCouponStatus {
  /// 未使用
  UNUSED   @map("unused")
  /// 已使用
  USED     @map("used")
  /// 已过期
  EXPIRED  @map("expired")
  /// 已冻结
  FROZEN   @map("frozen")
}

/// 促销活动状态
enum PromotionStatus {
  /// 未开始
  NOT_STARTED @map("not_started")
  /// 进行中
  RUNNING     @map("running")
  /// 已结束
  ENDED       @map("ended")
  /// 已禁用
  DISABLED    @map("disabled")
}

/// 促销活动类型
enum PromotionType {
  /// 秒杀
  FLASH_SALE   @map("flash_sale")
  /// 限时折扣
  TIME_DISCOUNT @map("time_discount")
  /// 拼团
  GROUP_BUY    @map("group_buy")
}

/// 满减规则类型
enum FullReductionRuleType {
  /// 满额减
  AMOUNT    @map("amount")
  /// 满件减
  COUNT     @map("count")
  /// 满额折
  DISCOUNT  @map("discount")
}

/// 满减活动适用范围类型
enum FullReductionScopeType {
  /// 全场通用
  ALL       @map("all")
  /// 指定分类
  CATEGORY  @map("category")
  /// 指定商品
  PRODUCT   @map("product")
}

/// 拼团订单状态
enum GroupBuyOrderStatus {
  /// 待成团
  WAITING   @map("waiting")
  /// 已成团
  SUCCESS   @map("success")
  /// 拼团失败
  FAILED    @map("failed")
  /// 已取消
  CANCELLED @map("cancelled")
}

/// 拼团成员支付状态
enum GroupBuyPayStatus {
  /// 未支付
  UNPAID    @map("unpaid")
  /// 已支付
  PAID      @map("paid")
  /// 已退款
  REFUNDED  @map("refunded")
}

/// 积分规则类型
enum PointRuleType {
  /// 签到
  SIGN_IN    @map("sign_in")
  /// 消费
  CONSUME    @map("consume")
  /// 注册
  REGISTER   @map("register")
  /// 首单
  FIRST_ORDER @map("first_order")
  /// 生日
  BIRTHDAY   @map("birthday")
}

/// 积分商品类型
enum PointProductType {
  /// 实物商品
  PHYSICAL  @map("physical")
  /// 虚拟商品
  VIRTUAL   @map("virtual")
  /// 优惠券
  COUPON    @map("coupon")
}

/// 积分兑换记录状态
enum PointExchangeStatus {
  /// 待发货
  PENDING    @map("pending")
  /// 已发货
  SHIPPED    @map("shipped")
  /// 已完成
  COMPLETED  @map("completed")
  /// 已取消
  CANCELLED  @map("cancelled")
}

/// 优惠券模板表
model CouponTemplate {
  id              Int              @id @default(autoincrement())
  /// 优惠券名称
  name            String           @db.VarChar(100)
  /// 优惠券编码（唯一）
  code            String           @unique @db.VarChar(50)
  /// 优惠券类型
  type            CouponType
  /// 面额或折扣值
  value           Decimal          @db.Decimal(10, 2)
  /// 使用门槛金额
  minAmount       Decimal          @db.Decimal(10, 2)
  /// 最大折扣金额（折扣券专用）
  maxDiscount     Decimal?         @db.Decimal(10, 2) @map("max_discount")
  /// 发行总量（-1表示无限量）
  totalCount      Int              @map("total_count")
  /// 每人限领数量
  perLimitCount   Int              @map("per_limit_count")
  /// 领取开始时间
  receiveStartTime DateTime?       @map("receive_start_time")
  /// 领取结束时间
  receiveEndTime   DateTime?       @map("receive_end_time")
  /// 有效期类型
  validType       CouponValidType  @map("valid_type")
  /// 使用开始时间（FIXED模式）
  validStartTime  DateTime?        @map("valid_start_time")
  /// 使用结束时间（FIXED模式）
  validEndTime    DateTime?        @map("valid_end_time")
  /// 有效天数（DAYS模式）
  validDays       Int?             @map("valid_days")
  /// 适用范围类型
  scopeType       CouponScopeType  @map("scope_type")
  /// 适用范围ID列表
  scopeIds        Json?            @map("scope_ids")
  /// 是否可叠加使用
  stackable       Boolean          @default(false)
  /// 状态
  status          Status           @default(ENABLED)
  /// 使用说明
  description     String?          @db.VarChar(500)
  /// 创建者ID
  createdBy       String?          @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime         @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?          @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime         @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean          @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?        @map("deleted_at")
  /// 用户优惠券
  memberCoupons   MemberCoupon[]

  @@index([status])
  @@index([deleted])
  @@map("marketing_coupon_template")
}

/// 会员优惠券表
model MemberCoupon {
  id              Int                @id @default(autoincrement())
  /// 会员ID
  memberId        Int                @map("member_id")
  /// 优惠券模板ID
  templateId      Int                @map("template_id")
  /// 优惠券码（唯一）
  couponCode      String             @unique @db.VarChar(50)
  /// 来源
  source          CouponSource
  /// 来源ID（活动ID、订单ID等）
  sourceId        Int?               @map("source_id")
  /// 发放人ID（系统发放时）
  grantBy         Int?               @map("grant_by")
  /// 状态
  status          MemberCouponStatus @default(UNUSED)
  /// 领取/发放时间
  receiveTime     DateTime           @default(now()) @map("receive_time")
  /// 有效开始时间
  validStartTime  DateTime           @map("valid_start_time")
  /// 有效结束时间
  validEndTime    DateTime           @map("valid_end_time")
  /// 使用时间
  useTime         DateTime?          @map("use_time")
  /// 使用的订单ID
  orderId         Int?               @map("order_id")
  /// 使用的订单号
  orderNo         String?            @db.VarChar(50) @map("order_no")
  /// 实际抵扣金额
  discountAmount  Decimal?           @db.Decimal(10, 2) @map("discount_amount")
  /// 创建者ID
  createdBy       String?            @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime           @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?            @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime           @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean            @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?          @map("deleted_at")
  /// 优惠券模板
  template        CouponTemplate     @relation(fields: [templateId], references: [id])

  @@index([memberId])
  @@index([templateId])
  @@index([status])
  @@index([orderId])
  @@index([deleted])
  @@map("marketing_member_coupon")
}

/// 满减活动表
model FullReductionActivity {
  id              Int                      @id @default(autoincrement())
  /// 活动名称
  name            String                   @db.VarChar(100)
  /// 活动编码（唯一）
  code            String                   @unique @db.VarChar(50)
  /// 满减规则
  rules           Json
  /// 是否可与优惠券叠加
  stackable       Boolean                  @default(false)
  /// 优先级（数字越大优先级越高）
  priority        Int                      @default(0)
  /// 是否与其他满减活动互斥
  exclusive       Boolean                  @default(true)
  /// 开始时间
  startTime       DateTime                 @map("start_time")
  /// 结束时间
  endTime         DateTime                 @map("end_time")
  /// 适用范围类型
  scopeType       FullReductionScopeType   @map("scope_type")
  /// 适用范围ID列表
  scopeIds        Json?                    @map("scope_ids")
  /// 限定会员等级ID列表
  memberLevelIds  Json?                    @map("member_level_ids")
  /// 每人限参与次数（0表示不限）
  limitPerMember  Int                      @default(0) @map("limit_per_member")
  /// 是否仅限首单
  firstOrderOnly  Boolean                  @default(false) @map("first_order_only")
  /// 状态
  status          PromotionStatus          @default(NOT_STARTED)
  /// 活动描述
  description     String?                  @db.VarChar(500)
  /// 创建者ID
  createdBy       String?                  @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime                 @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?                  @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime                 @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean                  @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?                @map("deleted_at")

  @@index([status])
  @@index([startTime, endTime])
  @@index([deleted])
  @@map("marketing_full_reduction_activity")
}

/// 促销活动表
model Promotion {
  id              Int               @id @default(autoincrement())
  /// 活动名称
  name            String            @db.VarChar(100)
  /// 活动编码（唯一）
  code            String            @unique @db.VarChar(50)
  /// 活动类型
  type            PromotionType
  /// 开始时间
  startTime       DateTime          @map("start_time")
  /// 结束时间
  endTime         DateTime          @map("end_time")
  /// 状态
  status          PromotionStatus   @default(NOT_STARTED)
  /// 封面图
  coverImage      String?           @db.VarChar(500) @map("cover_image")
  /// 规则配置（拼团专用：成团人数、有效时长等）
  ruleConfig      Json?             @map("rule_config")
  /// 预热开始时间
  warmUpTime      DateTime?         @map("warm_up_time")
  /// 是否显示倒计时
  showCountdown   Boolean           @default(true) @map("show_countdown")
  /// 限定会员等级ID列表
  memberLevelIds  Json?             @map("member_level_ids")
  /// 每人限购次数（0不限）
  limitPerMember  Int               @default(0) @map("limit_per_member")
  /// 优先级
  priority        Int               @default(0)
  /// 活动描述
  description     String?           @db.VarChar(500)
  /// 创建者ID
  createdBy       String?           @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime          @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?           @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime          @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean           @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?         @map("deleted_at")
  /// 活动商品
  promotionProducts PromotionProduct[]
  /// 拼团订单
  groupBuyOrders  GroupBuyOrder[]

  @@index([status])
  @@index([type])
  @@index([startTime, endTime])
  @@index([deleted])
  @@map("marketing_promotion")
}

/// 促销活动商品表
model PromotionProduct {
  id              Int           @id @default(autoincrement())
  /// 活动ID
  promotionId     Int           @map("promotion_id")
  /// 商品ID
  productId       Int           @map("product_id")
  /// SKU ID（精确到规格）
  skuId           Int?          @map("sku_id")
  /// 原价
  originalPrice   Decimal       @db.Decimal(10, 2) @map("original_price")
  /// 活动价
  activityPrice   Decimal       @db.Decimal(10, 2) @map("activity_price")
  /// 活动库存
  activityStock   Int           @map("activity_stock")
  /// 已售数量
  soldCount       Int           @default(0) @map("sold_count")
  /// 每人限购数量
  limitCount      Int           @default(0) @map("limit_count")
  /// 排序
  sort            Int           @default(0)
  /// 状态
  status          Status        @default(ENABLED)
  /// 创建者ID
  createdBy       String?       @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime      @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?       @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime      @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean       @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?     @map("deleted_at")
  /// 促销活动
  promotion       Promotion     @relation(fields: [promotionId], references: [id], onDelete: Cascade)

  @@index([promotionId])
  @@index([productId])
  @@index([skuId])
  @@index([status])
  @@index([deleted])
  @@map("marketing_promotion_product")
}

/// 拼团订单表
model GroupBuyOrder {
  id                  Int                @id @default(autoincrement())
  /// 团单号（唯一）
  groupNo             String             @unique @db.VarChar(50) @map("group_no")
  /// 活动ID
  promotionId         Int                @map("promotion_id")
  /// 活动商品ID
  promotionProductId  Int                @map("promotion_product_id")
  /// 商品ID
  productId           Int                @map("product_id")
  /// SKU ID
  skuId               Int?               @map("sku_id")
  /// 团长会员ID
  leaderId            Int                @map("leader_id")
  /// 成团所需人数
  requiredCount       Int                @map("required_count")
  /// 当前已参团人数
  currentCount        Int                @default(1) @map("current_count")
  /// 拼团价格
  groupPrice          Decimal            @db.Decimal(10, 2) @map("group_price")
  /// 状态
  status              GroupBuyOrderStatus @default(WAITING)
  /// 开团时间
  startTime           DateTime           @default(now()) @map("start_time")
  /// 截止时间
  expireTime          DateTime           @map("expire_time")
  /// 成团时间
  successTime         DateTime?          @map("success_time")
  /// 失败原因
  failReason          String?            @db.VarChar(200) @map("fail_reason")
  /// 创建者ID
  createdBy           String?            @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt           DateTime           @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy           String?            @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt           DateTime           @updatedAt @map("updated_at")
  /// 删除标记
  deleted             Boolean            @default(false) @map("deleted")
  /// 删除时间
  deletedAt           DateTime?          @map("deleted_at")
  /// 促销活动
  promotion           Promotion          @relation(fields: [promotionId], references: [id])
  /// 拼团成员
  members             GroupBuyMember[]

  @@index([promotionId])
  @@index([productId])
  @@index([leaderId])
  @@index([status])
  @@index([expireTime])
  @@index([deleted])
  @@map("marketing_group_buy_order")
}

/// 拼团成员表
model GroupBuyMember {
  id              Int               @id @default(autoincrement())
  /// 团单ID
  groupOrderId    Int               @map("group_order_id")
  /// 会员ID
  memberId        Int               @map("member_id")
  /// 是否团长
  isLeader        Boolean           @default(false) @map("is_leader")
  /// 参团订单ID
  orderId         Int?              @map("order_id")
  /// 参团订单号
  orderNo         String?           @db.VarChar(50) @map("order_no")
  /// 支付状态
  payStatus       GroupBuyPayStatus @default(UNPAID) @map("pay_status")
  /// 支付时间
  payTime         DateTime?         @map("pay_time")
  /// 退款时间
  refundTime      DateTime?         @map("refund_time")
  /// 退款原因
  refundReason    String?           @db.VarChar(200) @map("refund_reason")
  /// 参团时间
  joinTime        DateTime          @default(now()) @map("join_time")
  /// 创建者ID
  createdBy       String?           @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime          @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?           @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime          @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean           @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?         @map("deleted_at")
  /// 拼团订单
  groupOrder      GroupBuyOrder     @relation(fields: [groupOrderId], references: [id], onDelete: Cascade)

  @@index([groupOrderId])
  @@index([memberId])
  @@index([payStatus])
  @@index([deleted])
  @@map("marketing_group_buy_member")
}

/// 积分规则表
model PointRule {
  id              Int           @id @default(autoincrement())
  /// 规则编码（唯一）
  code            String        @unique @db.VarChar(50)
  /// 规则名称
  name            String        @db.VarChar(100)
  /// 规则类型
  type            PointRuleType
  /// 基础赠送积分
  points          Int
  /// 消费金额单位（CONSUME类型：每消费X元送points积分）
  consumeUnit     Decimal?      @db.Decimal(10, 2) @map("consume_unit")
  /// 额外规则（如连续签到奖励）
  extraRules      Json?         @map("extra_rules")
  /// 每日上限（0表示不限）
  dailyLimit      Int           @default(0) @map("daily_limit")
  /// 总上限（0表示不限）
  totalLimit      Int           @default(0) @map("total_limit")
  /// 积分有效期（天，0表示永不过期）
  validDays       Int           @default(0) @map("valid_days")
  /// 规则生效开始时间
  startTime       DateTime?     @map("start_time")
  /// 规则生效结束时间
  endTime         DateTime?     @map("end_time")
  /// 状态
  status          Status        @default(ENABLED)
  /// 规则说明
  description     String?       @db.VarChar(500)
  /// 创建者ID
  createdBy       String?       @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime      @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?       @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime      @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean       @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?     @map("deleted_at")

  @@index([type])
  @@index([status])
  @@index([deleted])
  @@map("marketing_point_rule")
}

/// 积分商品表
model PointProduct {
  id              Int               @id @default(autoincrement())
  /// 商品名称
  name            String            @db.VarChar(100)
  /// 商品编码（唯一）
  code            String            @unique @db.VarChar(50)
  /// 商品图片
  image           String?           @db.VarChar(500)
  /// 兑换所需积分
  points          Int
  /// 积分+金额模式的金额
  price           Decimal?          @db.Decimal(10, 2)
  /// 库存
  stock           Int
  /// 已兑换数量
  exchangedCount  Int               @default(0) @map("exchanged_count")
  /// 每人限兑数量（0不限）
  limitCount      Int               @default(0) @map("limit_count")
  /// 兑换开始时间
  startTime       DateTime?         @map("start_time")
  /// 兑换结束时间
  endTime         DateTime?         @map("end_time")
  /// 商品类型
  productType     PointProductType  @map("product_type")
  /// 关联商品ID（实物商品）
  relatedProductId Int?             @map("related_product_id")
  /// 关联优惠券模板ID
  relatedCouponId  Int?             @map("related_coupon_id")
  /// 虚拟商品内容（如兑换码）
  virtualContent  String?           @db.VarChar(500) @map("virtual_content")
  /// 排序
  sort            Int               @default(0)
  /// 状态
  status          Status            @default(ENABLED)
  /// 商品描述
  description     String?           @db.VarChar(500)
  /// 创建者ID
  createdBy       String?           @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime          @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?           @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime          @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean           @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?         @map("deleted_at")
  /// 兑换记录
  exchangeRecords PointExchangeRecord[]

  @@index([status])
  @@index([productType])
  @@index([deleted])
  @@map("marketing_point_product")
}

/// 积分兑换记录表
model PointExchangeRecord {
  id              Int                @id @default(autoincrement())
  /// 兑换单号（唯一）
  exchangeNo      String             @unique @db.VarChar(50) @map("exchange_no")
  /// 会员ID
  memberId        Int                @map("member_id")
  /// 积分商品ID
  pointProductId  Int                @map("point_product_id")
  /// 商品名称（冗余，防止商品修改）
  productName     String             @db.VarChar(100) @map("product_name")
  /// 商品类型
  productType     PointProductType   @map("product_type")
  /// 兑换数量
  quantity        Int
  /// 消耗积分
  points          Int
  /// 支付金额（积分+金额模式）
  price           Decimal?           @db.Decimal(10, 2)
  /// 状态
  status          PointExchangeStatus @default(PENDING)
  /// 收货地址（实物商品）
  addressInfo     Json?              @map("address_info")
  /// 物流信息
  shippingInfo    Json?              @map("shipping_info")
  /// 虚拟商品内容
  virtualContent  String?            @db.VarChar(500) @map("virtual_content")
  /// 备注
  remark          String?            @db.VarChar(500)
  /// 创建者ID
  createdBy       String?            @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime           @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?            @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime           @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean            @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime?          @map("deleted_at")
  /// 积分商品
  pointProduct    PointProduct       @relation(fields: [pointProductId], references: [id])

  @@index([memberId])
  @@index([pointProductId])
  @@index([status])
  @@index([createdAt])
  @@index([deleted])
  @@map("marketing_point_exchange_record")
}

/// 会员签到记录表
model MemberSignIn {
  id              Int       @id @default(autoincrement())
  /// 会员ID
  memberId        Int       @map("member_id")
  /// 签到日期
  signDate        DateTime  @map("sign_date") @db.Date
  /// 获得积分（含奖励）
  points          Int
  /// 基础积分
  basePoints      Int       @map("base_points")
  /// 连续签到奖励积分
  bonusPoints     Int       @map("bonus_points")
  /// 连续签到天数
  consecutiveDays Int       @map("consecutive_days")
  /// 创建者ID
  createdBy       String?   @map("created_by") @db.VarChar(64)
  /// 创建时间
  createdAt       DateTime  @default(now()) @map("created_at")
  /// 更新者ID
  updatedBy       String?   @map("updated_by") @db.VarChar(64)
  /// 更新时间
  updatedAt       DateTime  @updatedAt @map("updated_at")
  /// 删除标记
  deleted         Boolean   @default(false) @map("deleted")
  /// 删除时间
  deletedAt       DateTime? @map("deleted_at")

  @@unique([memberId, signDate])
  @@index([memberId])
  @@index([signDate])
  @@index([deleted])
  @@map("marketing_member_sign_in")
}
