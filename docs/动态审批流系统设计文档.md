# åŠ¨æ€å®¡æ‰¹æµç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v2.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-26
> **æ›´æ–°æ—¥æœŸ**: 2025-12-26
> **é¡¹ç›®**: nest-react-admin

---

## ğŸ“‹ å®ç°è¿›åº¦æ€»è§ˆ

### âœ… å·²å®Œæˆ
- **æ•°æ®åº“æ¨¡å‹**ï¼šWfFlowDefinition, WfNodeConfig, WfFlowInstance, WfTask, WfFlowLog, WfCopyRecord, WfCategory
- **å¤šçº§åˆ†ç±»ç®¡ç†**ï¼šæ”¯æŒæ— é™å±‚çº§ï¼ŒåŒ…å«é¢œè‰²ã€å›¾æ ‡ç­‰å¯è§†åŒ–é…ç½®
- **åç«¯API**ï¼šåˆ†ç±»ç®¡ç†å®Œæ•´CRUDï¼Œæ ‘å½¢ç»“æ„æ„å»º
- **æµç¨‹å®šä¹‰CRUD API**ï¼šå®Œæ•´çš„å¢åˆ æ”¹æŸ¥æ¥å£
- **å‰ç«¯é¡µé¢**ï¼š
  - æµç¨‹åˆ†ç±»ç®¡ç†é¡µé¢ï¼ˆæ”¯æŒå¤šçº§é€‰æ‹©ï¼‰
  - æµç¨‹å®šä¹‰åˆ—è¡¨é¡µé¢ï¼ˆæ”¯æŒåˆ†ç±»ç­›é€‰ï¼‰
  - **æµç¨‹è®¾è®¡å™¨**ï¼ˆ@antv/x6é›†æˆï¼‰
    - æ‹–æ‹½æ·»åŠ èŠ‚ç‚¹ï¼ˆ6ç§èŠ‚ç‚¹ç±»å‹ï¼šå¼€å§‹/å®¡æ‰¹/æ¡ä»¶/å¹¶è¡Œ/æ±‡èš/ç»“æŸï¼‰
    - èŠ‚ç‚¹è¿çº¿ï¼ˆè‡ªåŠ¨å¸é™„ã€æ­£äº¤è·¯ç”±ï¼‰
    - åˆ é™¤èŠ‚ç‚¹/è¾¹ï¼ˆé€‰ä¸­åæŒ‰ Delete é”®ï¼‰
    - èŠ‚ç‚¹é«˜äº®é€‰ä¸­çŠ¶æ€
  - **èŠ‚ç‚¹é…ç½®é¢æ¿**ï¼šå®¡æ‰¹äººã€æ¡ä»¶ã€æŠ„é€ã€è¶…æ—¶ç­‰é…ç½®
  - **è¡¨å•è®¾è®¡å™¨**ï¼šåŠ¨æ€è¡¨å•å­—æ®µè®¾è®¡
  - **æµç¨‹å±æ€§é…ç½®**ï¼šåç§°ã€ç¼–ç ã€åˆ†ç±»ã€ä¸šåŠ¡è¡¨ã€æè¿°
- **æƒé™ç³»ç»Ÿ**ï¼šå®Œæ•´çš„æƒé™å¸¸é‡å®šä¹‰å’Œè·¯ç”±æ§åˆ¶

### âœ… å·²å®Œæˆ
- **CQRS æ¶æ„é‡æ„**ï¼š7ä¸ªå‘½ä»¤ + 7ä¸ªæŸ¥è¯¢ + 4ä¸ªäº‹ä»¶å¤„ç†å™¨
- **æµç¨‹å¼•æ“æ ¸å¿ƒ**ï¼šå¯åŠ¨ã€æ‰§è¡Œã€æ¨è¿›ã€ç»“æŸå®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- **å®¡æ‰¹ä»»åŠ¡å¤„ç†**ï¼šé€šè¿‡/é©³å›/è½¬åŠ/åŠ ç­¾å››ç§æ“ä½œ
- **æµç¨‹å®ä¾‹ç®¡ç†**ï¼šåˆ›å»ºã€æŸ¥è¯¢ã€å–æ¶ˆã€ç»ˆæ­¢
- **äº‹ä»¶é©±åŠ¨**ï¼šé¢†åŸŸäº‹ä»¶å‘å¸ƒä¸å¤„ç†ï¼ˆæ—¥å¿—ã€é€šçŸ¥ï¼‰
- **èŠ‚ç‚¹ç±»å‹æ”¯æŒ**ï¼šå¼€å§‹ã€å®¡æ‰¹ã€æ¡ä»¶ã€å¹¶è¡Œã€æ±‡èšã€ç»“æŸ
- **å®¡æ‰¹æ–¹å¼**ï¼šä¼šç­¾ï¼ˆAND_SIGNï¼‰ã€æˆ–ç­¾ï¼ˆOR_SIGNï¼‰
- **å®¡æ‰¹äººè§£æ**ï¼šè§’è‰²ã€éƒ¨é—¨é¢†å¯¼ã€æŒ‡å®šäººå‘˜ã€å‘èµ·äººä¸Šçº§ã€è¡¨å•å­—æ®µ
- **ç©ºå®¡æ‰¹äººå¤„ç†**ï¼šè·³è¿‡ã€è½¬ç®¡ç†å‘˜ã€æŠ¥é”™ä¸‰ç§ç­–ç•¥
- **æŠ„é€åŠŸèƒ½**ï¼šè‡ªåŠ¨æŠ„é€é…ç½®äººå‘˜
- **æ¡ä»¶åˆ†æ”¯**ï¼šåŸºäºè¡¨å•æ•°æ®çš„åŠ¨æ€åˆ†æ”¯é€‰æ‹©
- **å¹¶è¡Œç½‘å…³**ï¼šå¤šåˆ†æ”¯å¹¶è¡Œæ‰§è¡Œ
- **å‰ç«¯æœåŠ¡å±‚**ï¼šå®Œæ•´çš„ API è°ƒç”¨å°è£…

---

---

## ä¸€ã€éœ€æ±‚æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

ä¸º nest-react-admin åå°ç®¡ç†ç³»ç»Ÿå¢åŠ é€šç”¨çš„åŠ¨æ€å®¡æ‰¹æµåŠŸèƒ½ï¼Œæ”¯æŒè¯·å‡ã€æŠ¥é”€ã€é‡‡è´­ç­‰å¤šç§ä¸šåŠ¡åœºæ™¯çš„å®¡æ‰¹æµç¨‹é…ç½®å’Œæ‰§è¡Œã€‚

### 1.2 åŠŸèƒ½éœ€æ±‚

| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| **æµç¨‹å®šä¹‰** | å¯è§†åŒ–è®¾è®¡å®¡æ‰¹æµç¨‹ï¼Œé…ç½®èŠ‚ç‚¹ã€è¿çº¿ã€æ¡ä»¶ |
| **æµç¨‹å‘èµ·** | ç”¨æˆ·å‘èµ·å®¡æ‰¹ï¼Œå¡«å†™è¡¨å•ï¼Œæäº¤æµç¨‹ |
| **å®¡æ‰¹å¤„ç†** | å®¡æ‰¹äººå¤„ç†å¾…åŠä»»åŠ¡ï¼šé€šè¿‡/é©³å›/è½¬åŠ/åŠ ç­¾ |
| **ä»»åŠ¡ä¸­å¿ƒ** | å¾…æˆ‘å®¡æ‰¹ã€æˆ‘å‘èµ·çš„ã€æˆ‘å·²å®¡æ‰¹ã€æŠ„é€æˆ‘çš„ |
| **æµç¨‹ç›‘æ§** | æŸ¥çœ‹æµç¨‹è¿›åº¦ã€å†å²è®°å½•ã€æµç¨‹å›¾å¯è§†åŒ– |
| **ä¸šåŠ¡é›†æˆ** | å®¡æ‰¹å®Œæˆåè§¦å‘ä¸šåŠ¡å›è°ƒ |

### 1.3 æŠ€æœ¯è¦æ±‚

- **ä¸šåŠ¡åœºæ™¯**ï¼šé€šç”¨å®¡æ‰¹æµç¨‹ï¼ˆè¯·å‡ã€æŠ¥é”€ã€é‡‡è´­ç­‰ï¼‰
- **æµç¨‹å¤æ‚åº¦**ï¼šåŠ¨æ€å®¡æ‰¹æµï¼ˆè‡ªå®šä¹‰èŠ‚ç‚¹ã€æ¡ä»¶åˆ†æ”¯ã€ä¼šç­¾/æˆ–ç­¾ï¼‰
- **å®¡æ‰¹äººæ¨¡å¼**ï¼šæ··åˆæ¨¡å¼ï¼ˆæŒ‰è§’è‰²/æŒ‰éƒ¨é—¨å±‚çº§/æŒ‡å®šäººå‘˜ï¼‰
- **æ¶æ„æ¨¡å¼**ï¼šCQRS + äº‹ä»¶é©±åŠ¨ï¼ˆä¸ç°æœ‰ Job æ¨¡å—ä¿æŒä¸€è‡´ï¼‰
- **å®¡æ‰¹äººä¸ºç©º**ï¼šæ”¯æŒè·³è¿‡/è½¬ç®¡ç†å‘˜/æŠ¥é”™ä¸‰ç§ç­–ç•¥

### 1.4 èŠ‚ç‚¹ç±»å‹è¯´æ˜

| èŠ‚ç‚¹ç±»å‹ | å›¾æ ‡ | è¯´æ˜ |
|---------|------|------|
| `START` | â—‹ | å¼€å§‹èŠ‚ç‚¹ï¼Œæµç¨‹å…¥å£ |
| `END` | â—‰ | ç»“æŸèŠ‚ç‚¹ï¼Œæµç¨‹å‡ºå£ |
| `APPROVAL` | â–¡ | å®¡æ‰¹èŠ‚ç‚¹ï¼Œéœ€è¦äººå·¥å®¡æ‰¹ |
| `CONDITION` | â—‡ | æ¡ä»¶åˆ†æ”¯ï¼Œæ ¹æ®æ¡ä»¶é€‰æ‹©è·¯å¾„ |
| `PARALLEL` | âŠ• | å¹¶è¡Œç½‘å…³ï¼ŒåŒæ—¶æ‰§è¡Œå¤šä¸ªåˆ†æ”¯ |
| `JOIN` | âŠ— | æ±‡èšç½‘å…³ï¼Œç­‰å¾…æ‰€æœ‰å¹¶è¡Œåˆ†æ”¯å®Œæˆ |

### 1.5 å®¡æ‰¹æ–¹å¼è¯´æ˜

| å®¡æ‰¹æ–¹å¼ | è¯´æ˜ |
|---------|------|
| **æˆ–ç­¾ (OR_SIGN)** | å¤šä¸ªå®¡æ‰¹äººä¸­ä»»ä¸€äººé€šè¿‡å³å¯æ¨è¿› |
| **ä¼šç­¾ (AND_SIGN)** | æ‰€æœ‰å®¡æ‰¹äººéƒ½å¿…é¡»é€šè¿‡æ‰èƒ½æ¨è¿› |

### 1.6 å®¡æ‰¹äººé€‰æ‹©æ–¹å¼

| æ–¹å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `ROLE` | æŒ‰è§’è‰² | å…·æœ‰"è´¢åŠ¡å®¡æ‰¹å‘˜"è§’è‰²çš„ç”¨æˆ· |
| `DEPT_LEADER` | éƒ¨é—¨é¢†å¯¼ | å‘èµ·äººæ‰€åœ¨éƒ¨é—¨çš„é¢†å¯¼ |
| `SPECIFIC_USER` | æŒ‡å®šäººå‘˜ | æŒ‡å®šå¼ ä¸‰ã€æå››å®¡æ‰¹ |
| `INITIATOR_LEADER` | å‘èµ·äººä¸Šçº§ | å‘èµ·äººçš„ç›´æ¥ä¸Šçº§é¢†å¯¼ |
| `FORM_FIELD` | è¡¨å•å­—æ®µ | ä»è¡¨å•ä¸­è¯»å–å®¡æ‰¹äººID |

### 1.7 å®¡æ‰¹äººä¸ºç©ºå¤„ç†ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ |
|------|------|
| `SKIP` | è·³è¿‡è¯¥èŠ‚ç‚¹ï¼Œè‡ªåŠ¨æ¨è¿›åˆ°ä¸‹ä¸€èŠ‚ç‚¹ |
| `TO_ADMIN` | è½¬ç»™ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆadmin è§’è‰²ç”¨æˆ·ï¼‰å¤„ç† |
| `ERROR` | æŠ¥é”™ç»ˆæ­¢æµç¨‹ï¼Œæç¤º"æ‰¾ä¸åˆ°å®¡æ‰¹äºº" |

---

## äºŒã€ç³»ç»Ÿæ¶æ„å›¾

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯ (React)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æµç¨‹è®¾è®¡å™¨    â”‚   ä»»åŠ¡ä¸­å¿ƒ    â”‚   æµç¨‹ç›‘æ§    â”‚   ä¸šåŠ¡è¡¨å•      â”‚
â”‚  (@antv/x6)   â”‚  (å¾…åŠ/å·²åŠ)  â”‚  (è¿›åº¦/å†å²)  â”‚  (åŠ¨æ€æ¸²æŸ“)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       åç«¯ (NestJS)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Controller  â”‚â†’ â”‚  CommandBus  â”‚â†’ â”‚   Handler    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  QueryBus    â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                    â”‚
â”‚                                             â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                   æµç¨‹å¼•æ“ (Engine)                    â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  EngineService â”‚ NodeExecutor â”‚ ConditionEvaluator   â”‚       â”‚
â”‚  â”‚  AssigneeResolver â”‚ ...                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼ EventBus                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚NotifyHandler â”‚  â”‚CallbackHandlerâ”‚  â”‚  LogHandler  â”‚           â”‚
â”‚  â”‚  (å‘é€é€šçŸ¥)   â”‚  â”‚  (ä¸šåŠ¡å›è°ƒ)   â”‚  â”‚  (è®°å½•æ—¥å¿—)  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å±‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   PostgreSQL     â”‚      Redis       â”‚        BullMQ             â”‚
â”‚   (æŒä¹…åŒ–å­˜å‚¨)    â”‚   (ç¼“å­˜/ä¼šè¯)    â”‚      (ä»»åŠ¡é˜Ÿåˆ—)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 CQRS æ¶æ„å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            Controller               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                   â”‚                   â”‚
              â–¼                   â”‚                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   CommandBus    â”‚           â”‚         â”‚    QueryBus     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚                  â”‚
             â–¼                    â”‚                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CommandHandler  â”‚           â”‚         â”‚  QueryHandler   â”‚
    â”‚                 â”‚           â”‚         â”‚                 â”‚
    â”‚ - StartFlow     â”‚           â”‚         â”‚ - GetPending    â”‚
    â”‚ - ApproveTask   â”‚           â”‚         â”‚ - GetInstance   â”‚
    â”‚ - RejectTask    â”‚           â”‚         â”‚ - GetHistory    â”‚
    â”‚ - TransferTask  â”‚           â”‚         â”‚                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚                  â”‚
             â–¼                    â”‚                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    Service      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    Service      â”‚
    â”‚   (å†™æ“ä½œ)       â”‚                     â”‚   (è¯»æ“ä½œ)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                       â”‚
             â–¼                                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    EventBus     â”‚                     â”‚    Database     â”‚
    â”‚   (å‘å¸ƒäº‹ä»¶)     â”‚                     â”‚    (æŸ¥è¯¢)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼        â–¼        â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Notify â”‚â”‚Callbackâ”‚â”‚ Log   â”‚     â”‚  å…¶ä»–...   â”‚
â”‚Handlerâ”‚â”‚Handler â”‚â”‚Handlerâ”‚     â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€ä¸šåŠ¡æµç¨‹å›¾

### 3.1 æµç¨‹è®¾è®¡æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°å»º   â”‚ â†’  â”‚  è®¾è®¡   â”‚ â†’  â”‚  é…ç½®   â”‚ â†’  â”‚  ä¿å­˜   â”‚ â†’  â”‚  å‘å¸ƒ   â”‚
â”‚  æµç¨‹   â”‚    â”‚  èŠ‚ç‚¹   â”‚    â”‚  èŠ‚ç‚¹   â”‚    â”‚  è‰ç¨¿   â”‚    â”‚  ä¸Šçº¿   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚              â”‚
     â–¼              â–¼              â–¼              â–¼              â–¼
  å¡«å†™åç§°      æ‹–æ‹½èŠ‚ç‚¹       é…ç½®å®¡æ‰¹äºº      å­˜å‚¨åˆ°DB      çŠ¶æ€æ”¹ä¸º
  åˆ†ç±»æè¿°      è¿æ¥è¾¹çº¿       æ¡ä»¶è¡¨è¾¾å¼      flowData      PUBLISHED
```

### 3.2 æµç¨‹å‘èµ·æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©   â”‚ â†’  â”‚  å¡«å†™   â”‚ â†’  â”‚  æäº¤   â”‚ â†’  â”‚  åˆ›å»º   â”‚ â†’  â”‚  æ‰§è¡Œ   â”‚
â”‚  æµç¨‹   â”‚    â”‚  è¡¨å•   â”‚    â”‚  ç”³è¯·   â”‚    â”‚  å®ä¾‹   â”‚    â”‚  å¼•æ“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚              â”‚
     â–¼              â–¼              â–¼              â–¼              â–¼
  è·å–å¯ç”¨      æ¸²æŸ“åŠ¨æ€       æ ¡éªŒæ•°æ®      Instance      æ¨è¿›åˆ°
  æµç¨‹åˆ—è¡¨      è¡¨å•å­—æ®µ       æƒé™æ£€æŸ¥      + formData    ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
```

### 3.3 å®¡æ‰¹å¤„ç†æµç¨‹

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  å¾…åŠä»»åŠ¡   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼               â–¼               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   é€šè¿‡   â”‚    â”‚   é©³å›   â”‚    â”‚  è½¬åŠ/   â”‚
         â”‚ APPROVE  â”‚    â”‚  REJECT  â”‚    â”‚  åŠ ç­¾    â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚               â”‚               â”‚
              â–¼               â–¼               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ æ£€æŸ¥ä¼šç­¾ â”‚    â”‚ æµç¨‹é©³å› â”‚    â”‚ åˆ›å»ºæ–°   â”‚
         â”‚ æ˜¯å¦å®Œæˆ â”‚    â”‚ çŠ¶æ€æ›´æ–° â”‚    â”‚ ä»»åŠ¡     â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚               â”‚
              â–¼               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ æ¨è¿›åˆ°   â”‚    â”‚ è§¦å‘é©³å› â”‚
         â”‚ ä¸‹ä¸€èŠ‚ç‚¹ â”‚    â”‚ å›è°ƒäº‹ä»¶ â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ ç›´åˆ°ç»“æŸ â”‚
         â”‚ èŠ‚ç‚¹     â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ è§¦å‘å®Œæˆ â”‚
         â”‚ å›è°ƒäº‹ä»¶ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æµç¨‹æ‰§è¡ŒçŠ¶æ€æœº

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   RUNNING   â”‚
                              â”‚   (è¿›è¡Œä¸­)   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                         â”‚                         â”‚
           â–¼                         â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  COMPLETED  â”‚          â”‚  REJECTED   â”‚          â”‚  CANCELLED  â”‚
    â”‚   (å·²å®Œæˆ)   â”‚          â”‚   (å·²é©³å›)   â”‚          â”‚   (å·²æ’¤å›)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚                         â”‚
           â–¼                         â–¼                         â–¼
    å®¡æ‰¹å…¨éƒ¨é€šè¿‡              ä»»ä¸€èŠ‚ç‚¹é©³å›               å‘èµ·äººæ’¤å›
    åˆ°è¾¾ç»“æŸèŠ‚ç‚¹              æµç¨‹ç»ˆæ­¢                  æµç¨‹å–æ¶ˆ
    è§¦å‘å®Œæˆå›è°ƒ              è§¦å‘é©³å›å›è°ƒ              è§¦å‘æ’¤å›å›è°ƒ

                                     â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ TERMINATED  â”‚
                            â”‚  (å·²ç»ˆæ­¢)    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                            ç®¡ç†å‘˜å¼ºåˆ¶ç»ˆæ­¢
```

---

## å››ã€æ•°æ®æµè½¬å›¾

### 4.1 æµç¨‹å‘èµ·æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯    â”‚     â”‚  Controller  â”‚     â”‚ CommandHandlerâ”‚     â”‚   Service    â”‚
â”‚          â”‚     â”‚              â”‚     â”‚               â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚                    â”‚
     â”‚  POST /start     â”‚                     â”‚                    â”‚
     â”‚  {flowId,        â”‚                     â”‚                    â”‚
     â”‚   formData,      â”‚                     â”‚                    â”‚
     â”‚   businessId}    â”‚                     â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚
     â”‚                  â”‚  StartFlowCommand   â”‚                    â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚
     â”‚                  â”‚                     â”‚  startFlow()       â”‚
     â”‚                  â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                  â”‚                     â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚â”€â”€â”
     â”‚                  â”‚                     â”‚                    â”‚  â”‚ 1. åˆ›å»º Instance
     â”‚                  â”‚                     â”‚                    â”‚  â”‚ 2. ä¿å­˜ formData
     â”‚                  â”‚                     â”‚                    â”‚  â”‚ 3. è§£æç¬¬ä¸€ä¸ªèŠ‚ç‚¹
     â”‚                  â”‚                     â”‚                    â”‚  â”‚ 4. åˆ›å»ºå®¡æ‰¹ä»»åŠ¡
     â”‚                  â”‚                     â”‚                    â”‚â—„â”€â”˜
     â”‚                  â”‚                     â”‚                    â”‚
     â”‚                  â”‚                     â”‚    FlowStarted     â”‚
     â”‚                  â”‚                     â”‚    Event           â”‚
     â”‚                  â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                  â”‚                     â”‚                    â”‚
     â”‚                  â”‚     instance        â”‚                    â”‚
     â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚
     â”‚   {instanceId,   â”‚                     â”‚                    â”‚
     â”‚    instanceNo}   â”‚                     â”‚                    â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚
```

### 4.2 å®¡æ‰¹å¤„ç†æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯    â”‚     â”‚  Controller  â”‚     â”‚ CommandHandlerâ”‚     â”‚   Service    â”‚     â”‚   EventBus   â”‚
â”‚          â”‚     â”‚              â”‚     â”‚               â”‚     â”‚              â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚
     â”‚  POST /approve   â”‚                     â”‚                    â”‚                    â”‚
     â”‚  {taskId,        â”‚                     â”‚                    â”‚                    â”‚
     â”‚   comment}       â”‚                     â”‚                    â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                    â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚
     â”‚                  â”‚ ApproveTaskCommand  â”‚                    â”‚                    â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚
     â”‚                  â”‚                     â”‚  approveTask()     â”‚                    â”‚
     â”‚                  â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚â”€â”€â”                 â”‚
     â”‚                  â”‚                     â”‚                    â”‚  â”‚ 1. æ›´æ–°ä»»åŠ¡çŠ¶æ€  â”‚
     â”‚                  â”‚                     â”‚                    â”‚  â”‚ 2. è®°å½•å®¡æ‰¹æ„è§  â”‚
     â”‚                  â”‚                     â”‚                    â”‚  â”‚ 3. æ£€æŸ¥ä¼šç­¾å®Œæˆ  â”‚
     â”‚                  â”‚                     â”‚                    â”‚  â”‚ 4. æ¨è¿›ä¸‹ä¸€èŠ‚ç‚¹  â”‚
     â”‚                  â”‚                     â”‚                    â”‚â—„â”€â”˜                 â”‚
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚  TaskApprovedEvent â”‚
     â”‚                  â”‚                     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚â”€â”€â”
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚  â”‚ å¹¶è¡Œå¤„ç†:
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚  â”‚ - NotifyHandler
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚  â”‚ - LogHandler
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚â—„â”€â”˜
     â”‚                  â”‚                     â”‚     result         â”‚                    â”‚
     â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚
     â”‚   {success}      â”‚                     â”‚                    â”‚                    â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                    â”‚                    â”‚
     â”‚                  â”‚                     â”‚                    â”‚                    â”‚
```

### 4.3 æµç¨‹å¼•æ“èŠ‚ç‚¹æ‰§è¡Œæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æµç¨‹å¼•æ“ (EngineService)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚   è·å–å½“å‰èŠ‚ç‚¹      â”‚
                           â”‚   currentNodeIds    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚   è·å–èŠ‚ç‚¹é…ç½®      â”‚
                           â”‚   WfNodeConfig      â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                           â”‚                           â”‚
          â–¼                           â–¼                           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  APPROVAL   â”‚            â”‚  CONDITION  â”‚            â”‚  PARALLEL   â”‚
   â”‚  å®¡æ‰¹èŠ‚ç‚¹    â”‚            â”‚  æ¡ä»¶èŠ‚ç‚¹    â”‚            â”‚  å¹¶è¡ŒèŠ‚ç‚¹    â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚                          â”‚
          â–¼                          â–¼                          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Assignee    â”‚            â”‚ Condition   â”‚            â”‚ è·å–æ‰€æœ‰    â”‚
   â”‚ Resolver    â”‚            â”‚ Evaluator   â”‚            â”‚ å‡ºè¾¹èŠ‚ç‚¹    â”‚
   â”‚ è§£æå®¡æ‰¹äºº   â”‚            â”‚ è®¡ç®—æ¡ä»¶     â”‚            â”‚            â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚                          â”‚
          â–¼                          â–¼                          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ åˆ›å»º Task   â”‚            â”‚ é€‰æ‹©åŒ¹é…    â”‚            â”‚ å¹¶è¡Œæ¨è¿›    â”‚
   â”‚ ç­‰å¾…å®¡æ‰¹    â”‚            â”‚ çš„åˆ†æ”¯      â”‚            â”‚ æ‰€æœ‰åˆ†æ”¯    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚                          â”‚
                                     â–¼                          â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ æ¨è¿›åˆ°      â”‚            â”‚ ç­‰å¾… JOIN   â”‚
                              â”‚ ç›®æ ‡èŠ‚ç‚¹    â”‚            â”‚ æ±‡èšèŠ‚ç‚¹    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ•°æ®åº“æ¨¡å‹è®¾è®¡

### 5.1 ER å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WfFlowDefinition  â”‚       â”‚   WfNodeConfig    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)           â”‚â—„â”€â”€â”   â”‚ id (PK)           â”‚
â”‚ code              â”‚   â”‚   â”‚ flowDefinitionId  â”‚â”€â”€â”€â”
â”‚ name              â”‚   â”‚   â”‚ nodeId            â”‚   â”‚
â”‚ category          â”‚   â”‚   â”‚ nodeType          â”‚   â”‚
â”‚ version           â”‚   â”‚   â”‚ nodeName          â”‚   â”‚
â”‚ flowData (JSON)   â”‚   â”‚   â”‚ approvalType      â”‚   â”‚
â”‚ formData (JSON)   â”‚   â”‚   â”‚ assigneeType      â”‚   â”‚
â”‚ status            â”‚   â”‚   â”‚ assigneeConfig    â”‚   â”‚
â”‚ isMain            â”‚   â”‚   â”‚ conditionExpr     â”‚   â”‚
â”‚ businessTable     â”‚   â”‚   â”‚ formPerms         â”‚   â”‚
â”‚ ...               â”‚   â”‚   â”‚ emptyAction       â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚ timeLimit         â”‚   â”‚
         â”‚              â”‚   â”‚ ...               â”‚   â”‚
         â”‚              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚ 1:N          â”‚              â”‚            â”‚
         â–¼              â”‚              â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚            â”‚
â”‚  WfFlowInstance   â”‚   â”‚              â”‚ 1:N        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚              â–¼            â”‚
â”‚ id (PK)           â”‚â”€â”€â”€â”˜   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ instanceNo        â”‚       â”‚     WfTask        â”‚   â”‚
â”‚ flowDefinitionId  â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”˜
â”‚ title             â”‚       â”‚ id (PK)           â”‚
â”‚ businessId        â”‚       â”‚ taskNo            â”‚
â”‚ businessNo        â”‚  â”Œâ”€â”€â”€â–ºâ”‚ flowInstanceId    â”‚
â”‚ businessTable     â”‚  â”‚    â”‚ nodeId            â”‚
â”‚ formDataSnapshot  â”‚  â”‚    â”‚ nodeName          â”‚
â”‚ status            â”‚  â”‚    â”‚ nodeType          â”‚
â”‚ initiatorId       â”‚  â”‚    â”‚ status            â”‚
â”‚ currentNodeIds    â”‚  â”‚    â”‚ assigneeId        â”‚
â”‚ startTime         â”‚  â”‚    â”‚ assigneeName      â”‚
â”‚ endTime           â”‚  â”‚    â”‚ result            â”‚
â”‚ variables         â”‚  â”‚    â”‚ comment           â”‚
â”‚ ...               â”‚  â”‚    â”‚ startTime         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ completedTime     â”‚
         â”‚             â”‚    â”‚ dueTime           â”‚
         â”‚ 1:N         â”‚    â”‚ ...               â”‚
         â–¼             â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    WfFlowLog      â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ id (PK)           â”‚  â”‚
â”‚ flowInstanceId    â”‚â”€â”€â”˜
â”‚ taskId            â”‚
â”‚ nodeId            â”‚
â”‚ nodeName          â”‚
â”‚ action            â”‚
â”‚ fromStatus        â”‚
â”‚ toStatus          â”‚
â”‚ operatorId        â”‚
â”‚ operatorName      â”‚
â”‚ comment           â”‚
â”‚ detail            â”‚
â”‚ createdAt         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WfCopyRecord    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)           â”‚
â”‚ flowInstanceId    â”‚
â”‚ taskId            â”‚
â”‚ userId            â”‚
â”‚ userName          â”‚
â”‚ isRead            â”‚
â”‚ readTime          â”‚
â”‚ createdAt         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒæšä¸¾å®šä¹‰

```typescript
// æµç¨‹çŠ¶æ€
enum WfFlowStatus {
  DRAFT       // è‰ç¨¿
  PUBLISHED   // å·²å‘å¸ƒ
  DISABLED    // å·²åœç”¨
}

// èŠ‚ç‚¹ç±»å‹
enum WfNodeType {
  START       // å¼€å§‹èŠ‚ç‚¹
  END         // ç»“æŸèŠ‚ç‚¹
  APPROVAL    // å®¡æ‰¹èŠ‚ç‚¹
  CONDITION   // æ¡ä»¶åˆ†æ”¯
  PARALLEL    // å¹¶è¡Œç½‘å…³
  JOIN        // æ±‡èšç½‘å…³
}

// å®¡æ‰¹æ–¹å¼
enum WfApprovalType {
  OR_SIGN     // æˆ–ç­¾
  AND_SIGN    // ä¼šç­¾
}

// å®¡æ‰¹äººé€‰æ‹©æ–¹å¼
enum WfAssigneeType {
  ROLE              // æŒ‰è§’è‰²
  DEPT_LEADER       // éƒ¨é—¨é¢†å¯¼
  SPECIFIC_USER     // æŒ‡å®šäººå‘˜
  INITIATOR_LEADER  // å‘èµ·äººä¸Šçº§
  FORM_FIELD        // è¡¨å•å­—æ®µ
}

// å®¡æ‰¹äººä¸ºç©ºå¤„ç†
enum WfEmptyAssigneeAction {
  SKIP        // è·³è¿‡èŠ‚ç‚¹
  TO_ADMIN    // è½¬ç»™ç®¡ç†å‘˜
  ERROR       // æŠ¥é”™ç»ˆæ­¢
}

// æµç¨‹å®ä¾‹çŠ¶æ€
enum WfInstanceStatus {
  RUNNING     // è¿›è¡Œä¸­
  COMPLETED   // å·²å®Œæˆ
  REJECTED    // å·²é©³å›
  CANCELLED   // å·²æ’¤å›
  TERMINATED  // å·²ç»ˆæ­¢
}

// ä»»åŠ¡çŠ¶æ€
enum WfTaskStatus {
  PENDING       // å¾…å¤„ç†
  COMPLETED     // å·²å®Œæˆ
  CANCELLED     // å·²å–æ¶ˆ
  TRANSFERRED   // å·²è½¬åŠ
  COUNTERSIGNED // å·²åŠ ç­¾
}

// ä»»åŠ¡ç»“æœ
enum WfTaskResult {
  APPROVED      // é€šè¿‡
  REJECTED      // é©³å›
  TRANSFERRED   // è½¬åŠ
  COUNTERSIGNED // åŠ ç­¾
}

// æ“ä½œæ—¥å¿—ç±»å‹
enum WfLogAction {
  START       // å‘èµ·
  APPROVE     // é€šè¿‡
  REJECT      // é©³å›
  TRANSFER    // è½¬åŠ
  COUNTERSIGN // åŠ ç­¾
  CANCEL      // æ’¤å›
  URGE        // å‚¬åŠ
  TERMINATE   // ç»ˆæ­¢
  AUTO        // è‡ªåŠ¨å¤„ç†
}
```

---

## å…­ã€åç«¯æ¨¡å—ç»“æ„ï¼ˆCQRS æ¨¡å¼ï¼‰

```
apps/admin-api/src/modules/workflow/
â”œâ”€â”€ workflow.module.ts           # æ¨¡å—å…¥å£ï¼ˆæ³¨å†Œæ‰€æœ‰å¤„ç†å™¨ï¼‰
â”œâ”€â”€ commands/                    # CQRS å‘½ä»¤
â”‚   â”œâ”€â”€ instance/                # æµç¨‹å®ä¾‹å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ start-flow.command.ts
â”‚   â”‚   â”œâ”€â”€ cancel-flow.command.ts
â”‚   â”‚   â””â”€â”€ terminate-flow.command.ts
â”‚   â””â”€â”€ task/                    # ä»»åŠ¡å‘½ä»¤
â”‚       â”œâ”€â”€ approve-task.command.ts
â”‚       â”œâ”€â”€ reject-task.command.ts
â”‚       â”œâ”€â”€ transfer-task.command.ts
â”‚       â””â”€â”€ countersign-task.command.ts
â”œâ”€â”€ queries/                     # CQRS æŸ¥è¯¢
â”‚   â”œâ”€â”€ instance/
â”‚   â”‚   â”œâ”€â”€ get-flow-instances.query.ts
â”‚   â”‚   â”œâ”€â”€ get-my-initiated.query.ts
â”‚   â”‚   â””â”€â”€ get-flow-instance.query.ts
â”‚   â”œâ”€â”€ task/
â”‚   â”‚   â”œâ”€â”€ get-pending-tasks.query.ts
â”‚   â”‚   â”œâ”€â”€ get-completed-tasks.query.ts
â”‚   â”‚   â””â”€â”€ get-task-history.query.ts
â”‚   â””â”€â”€ copy/
â”‚       â””â”€â”€ get-copy-records.query.ts
â”œâ”€â”€ events/                      # é¢†åŸŸäº‹ä»¶
â”‚   â”œâ”€â”€ flow-started.event.ts
â”‚   â”œâ”€â”€ flow-completed.event.ts
â”‚   â”œâ”€â”€ flow-cancelled.event.ts
â”‚   â”œâ”€â”€ flow-terminated.event.ts
â”‚   â”œâ”€â”€ task-approved.event.ts
â”‚   â”œâ”€â”€ task-rejected.event.ts
â”‚   â””â”€â”€ task-transferred.event.ts
â”œâ”€â”€ handlers/                    # å¤„ç†å™¨
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ instance/
â”‚   â”‚   â”‚   â”œâ”€â”€ start-flow.handler.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ cancel-flow.handler.ts
â”‚   â”‚   â”‚   â””â”€â”€ terminate-flow.handler.ts
â”‚   â”‚   â””â”€â”€ task/
â”‚   â”‚       â”œâ”€â”€ approve-task.handler.ts
â”‚   â”‚       â”œâ”€â”€ reject-task.handler.ts
â”‚   â”‚       â”œâ”€â”€ transfer-task.handler.ts
â”‚   â”‚       â””â”€â”€ countersign-task.handler.ts
â”‚   â”œâ”€â”€ queries/
â”‚   â”‚   â”œâ”€â”€ instance/
â”‚   â”‚   â”‚   â”œâ”€â”€ get-flow-instances.handler.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ get-my-initiated.handler.ts
â”‚   â”‚   â”‚   â””â”€â”€ get-flow-instance.handler.ts
â”‚   â”‚   â”œâ”€â”€ task/
â”‚   â”‚   â”‚   â”œâ”€â”€ get-pending-tasks.handler.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ get-completed-tasks.handler.ts
â”‚   â”‚   â”‚   â””â”€â”€ get-task-history.handler.ts
â”‚   â”‚   â””â”€â”€ copy/
â”‚   â”‚       â””â”€â”€ get-copy-records.handler.ts
â”‚   â””â”€â”€ events/                  # äº‹ä»¶å¤„ç†å™¨
â”‚       â”œâ”€â”€ notify.handler.ts        # å‘é€é€šçŸ¥
â”‚       â”œâ”€â”€ callback.handler.ts      # ä¸šåŠ¡å›è°ƒ
â”‚       â””â”€â”€ flow-log.handler.ts      # è®°å½•æ—¥å¿—
â”œâ”€â”€ flow-definition/             # æµç¨‹å®šä¹‰ï¼ˆä¿æŒ CRUD é£æ ¼ï¼‰
â”‚   â”œâ”€â”€ flow-definition.controller.ts
â”‚   â”œâ”€â”€ flow-definition.service.ts
â”‚   â””â”€â”€ dto/
â”œâ”€â”€ flow-instance/               # æµç¨‹å®ä¾‹æœåŠ¡
â”‚   â”œâ”€â”€ flow-instance.service.ts
â”‚   â””â”€â”€ dto/
â”œâ”€â”€ task/                        # ä»»åŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ task.service.ts
â”‚   â””â”€â”€ dto/
â”œâ”€â”€ copy-record/                 # æŠ„é€è®°å½•
â”œâ”€â”€ engine/                      # æµç¨‹å¼•æ“æ ¸å¿ƒ
â”‚   â”œâ”€â”€ engine.service.ts
â”‚   â”œâ”€â”€ node-executor.service.ts
â”‚   â”œâ”€â”€ condition-evaluator.service.ts
â”‚   â””â”€â”€ assignee-resolver.service.ts
â””â”€â”€ types/                       # ç±»å‹å®šä¹‰
```

### 6.1 CQRS å®ç°æ¨¡å¼

æœ¬é¡¹ç›®é‡‡ç”¨ **è½»é‡çº§ CQRS** æ¨¡å¼ï¼Œéµå¾ªä»¥ä¸‹è§„èŒƒï¼š

**å‘½ä»¤ï¼ˆCommandï¼‰æ¨¡å¼**ï¼š
```typescript
// commands/instance/start-flow.command.ts
import { StartFlowDto } from '../dto';

export class StartFlowCommand {
  constructor(
    public readonly dto: StartFlowDto,
    public readonly initiator: {
      id: number;
      name: string;
      deptId?: number;
      deptName?: string;
    },
  ) {}
}
```

**å‘½ä»¤å¤„ç†å™¨ï¼ˆCommandHandlerï¼‰æ¨¡å¼**ï¼š
```typescript
// handlers/commands/instance/start-flow.handler.ts
import { CommandHandler, ICommandHandler } from '@nestjs/cqrs';
import { StartFlowCommand } from '../../commands/instance/start-flow.command';
import { FlowInstanceService } from '../../flow-instance/flow-instance.service';

@CommandHandler(StartFlowCommand)
export class StartFlowHandler implements ICommandHandler<StartFlowCommand> {
  constructor(private readonly flowInstanceService: FlowInstanceService) {}

  async execute(command: StartFlowCommand) {
    return this.flowInstanceService.start(command.dto, command.initiator);
  }
}
```

**æŸ¥è¯¢ï¼ˆQueryï¼‰æ¨¡å¼**ï¼š
```typescript
// queries/task/get-pending-tasks.query.ts
import { QueryTaskDto } from '../dto';

export class GetPendingTasksQuery {
  constructor(
    public readonly userId: number,
    public readonly query: QueryTaskDto,
  ) {}
}
```

**æŸ¥è¯¢å¤„ç†å™¨ï¼ˆQueryHandlerï¼‰æ¨¡å¼**ï¼š
```typescript
// handlers/queries/task/get-pending-tasks.handler.ts
import { IQueryHandler, QueryHandler } from '@nestjs/cqrs';
import { GetPendingTasksQuery } from '../../queries/task/get-pending-tasks.query';
import { TaskService } from '../../task/task.service';

@QueryHandler(GetPendingTasksQuery)
export class GetPendingTasksHandler implements IQueryHandler<GetPendingTasksQuery> {
  constructor(private readonly taskService: TaskService) {}

  async execute(query: GetPendingTasksQuery) {
    return this.taskService.findPendingByUser(query.userId, query.query);
  }
}
```

**æ§åˆ¶å™¨è°ƒç”¨æ–¹å¼**ï¼š
```typescript
// flow-instance.controller.ts
import { CommandBus, QueryBus } from '@nestjs/cqrs';

@Injectable()
export class FlowInstanceController {
  constructor(
    private readonly commandBus: CommandBus,
    private readonly queryBus: QueryBus,
  ) {}

  @Post('start')
  async start(@Body() dto: StartFlowDto) {
    const user = this.cls.get('user');
    return this.commandBus.execute(
      new StartFlowCommand(dto, { id: user.id, name: user.nickname }),
    );
  }

  @Get()
  async findAll(@Query() query: QueryFlowInstanceDto) {
    return this.queryBus.execute(new GetFlowInstancesQuery(query));
  }
}
```

### æ ¸å¿ƒ API

**æµç¨‹å®šä¹‰**ï¼š
- `GET /workflow/definition` - åˆ—è¡¨
- `POST /workflow/definition` - åˆ›å»º
- `PUT /workflow/definition/:id` - æ›´æ–°
- `POST /workflow/definition/:id/publish` - å‘å¸ƒ
- `POST /workflow/definition/:id/disable` - åœç”¨

**æµç¨‹å®ä¾‹**ï¼š
- `POST /workflow/instance/start` - å‘èµ·æµç¨‹
- `GET /workflow/instance/my-initiated` - æˆ‘å‘èµ·çš„
- `POST /workflow/instance/:id/cancel` - æ’¤å›

**å®¡æ‰¹ä»»åŠ¡**ï¼š
- `GET /workflow/task/pending` - å¾…æˆ‘å®¡æ‰¹
- `GET /workflow/task/completed` - æˆ‘å·²å®¡æ‰¹
- `POST /workflow/task/:id/approve` - é€šè¿‡
- `POST /workflow/task/:id/reject` - é©³å›
- `POST /workflow/task/:id/transfer` - è½¬åŠ
- `POST /workflow/task/:id/countersign` - åŠ ç­¾
- `POST /workflow/task/:id/urge` - å‚¬åŠ

---

## ä¸ƒã€å‰ç«¯é¡µé¢ç»“æ„

```
apps/admin-web/src/pages/workflow/
â”œâ”€â”€ definition/              # æµç¨‹å®šä¹‰ç®¡ç†
â”‚   â”œâ”€â”€ index.tsx            # åˆ—è¡¨é¡µ
â”‚   â””â”€â”€ design/              # æµç¨‹è®¾è®¡å™¨ï¼ˆ@antv/x6ï¼‰
â”‚       â”œâ”€â”€ index.tsx
â”‚       â””â”€â”€ components/
â”‚           â”œâ”€â”€ FlowCanvas.tsx        # æµç¨‹ç”»å¸ƒ
â”‚           â”œâ”€â”€ NodePanel.tsx         # èŠ‚ç‚¹é¢æ¿
â”‚           â”œâ”€â”€ NodeConfig.tsx        # èŠ‚ç‚¹é…ç½®
â”‚           â”œâ”€â”€ AssigneeConfig.tsx    # å®¡æ‰¹äººé…ç½®
â”‚           â””â”€â”€ ConditionConfig.tsx   # æ¡ä»¶é…ç½®
â”œâ”€â”€ instance/                # æµç¨‹å®ä¾‹
â”‚   â”œâ”€â”€ index.tsx            # åˆ—è¡¨é¡µ
â”‚   â””â”€â”€ detail/              # è¯¦æƒ…é¡µï¼ˆæµç¨‹å›¾+å†å²ï¼‰
â”œâ”€â”€ task/                    # ä»»åŠ¡ä¸­å¿ƒ
â”‚   â”œâ”€â”€ index.tsx            # å¾…åŠ/å·²åŠåˆ—è¡¨
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ ApproveModal.tsx
â”‚       â”œâ”€â”€ RejectModal.tsx
â”‚       â””â”€â”€ TransferModal.tsx
â””â”€â”€ copy/                    # æŠ„é€æˆ‘çš„
    â””â”€â”€ index.tsx
```

### æŠ€æœ¯é€‰å‹

- **æµç¨‹è®¾è®¡å™¨**ï¼š@antv/x6ï¼ˆé˜¿é‡Œå¼€æºï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä¸ Ant Design é£æ ¼ç»Ÿä¸€ï¼‰
- **çŠ¶æ€ç®¡ç†**ï¼šç»§ç»­ä½¿ç”¨ Zustand
- **æ•°æ®è¯·æ±‚**ï¼šç»§ç»­ä½¿ç”¨ @tanstack/react-query

---

## å…«ã€æ ¸å¿ƒæµç¨‹å¼•æ“é€»è¾‘

### 8.1 flowData æ•°æ®ç»“æ„

```typescript
interface FlowData {
  nodes: Array<{
    id: string;
    type: 'START' | 'END' | 'APPROVAL' | 'CONDITION' | 'PARALLEL' | 'JOIN';
    position: { x: number; y: number };
    data: { label: string };
  }>;
  edges: Array<{
    id: string;
    source: string;
    target: string;
    data?: { condition?: ConditionExpression };
  }>;
}

interface ConditionExpression {
  type: 'single' | 'group';
  // å•æ¡ä»¶
  field?: string;
  operator?: 'eq' | 'ne' | 'gt' | 'gte' | 'lt' | 'lte' | 'in' | 'contains';
  value?: any;
  // ç»„åˆæ¡ä»¶
  logic?: 'and' | 'or';
  conditions?: ConditionExpression[];
}
```

### 8.2 èŠ‚ç‚¹é…ç½®ç»“æ„

```typescript
interface NodeConfig {
  nodeId: string;
  nodeType: WfNodeType;
  nodeName: string;

  // å®¡æ‰¹èŠ‚ç‚¹é…ç½®
  approvalType?: WfApprovalType;
  assigneeType?: WfAssigneeType;
  assigneeConfig?: {
    roleIds?: number[];
    userIds?: number[];
    deptLevel?: number;
    fieldName?: string;
  };
  emptyAssigneeAction?: WfEmptyAssigneeAction;

  // è¡¨å•æƒé™
  formPerms?: {
    [fieldName: string]: {
      visible: boolean;
      editable: boolean;
    };
  };

  // è¶…æ—¶é…ç½®
  timeLimit?: number;
  timeoutAction?: 'AUTO_PASS' | 'AUTO_REJECT' | 'REMIND';
}
```

### 8.3 å…³é”®ç®—æ³•

1. **æ¡ä»¶åˆ†æ”¯**ï¼šæ ¹æ®è¡¨å•æ•°æ®è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼ï¼Œé€‰æ‹©åŒ¹é…çš„åˆ†æ”¯
2. **ä¼šç­¾æ£€æŸ¥**ï¼šæ‰€æœ‰å®¡æ‰¹äººéƒ½é€šè¿‡æ‰æ¨è¿›
3. **æˆ–ç­¾æ£€æŸ¥**ï¼šä»»ä¸€å®¡æ‰¹äººé€šè¿‡å³æ¨è¿›
4. **å¹¶è¡Œ/æ±‡èš**ï¼šå¹¶è¡Œåˆ†æ”¯åŒæ—¶æ‰§è¡Œï¼Œæ±‡èšèŠ‚ç‚¹ç­‰å¾…æ‰€æœ‰åˆ†æ”¯å®Œæˆ

---

## ä¹ã€å¼€å‘å®Œæˆæ€»ç»“

### âœ… æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®ç°

**åç«¯å®Œæˆåº¦ï¼š100%**
- âœ… CQRS æ¶æ„å®Œæ•´å®ç°ï¼ˆ7å‘½ä»¤ + 7æŸ¥è¯¢ + 4äº‹ä»¶ï¼‰
- âœ… æµç¨‹å¼•æ“æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¯åŠ¨ã€æ¨è¿›ã€ç»“æŸï¼‰
- âœ… æ‰€æœ‰èŠ‚ç‚¹ç±»å‹æ”¯æŒï¼ˆå¼€å§‹ã€å®¡æ‰¹ã€æ¡ä»¶ã€å¹¶è¡Œã€æ±‡èšã€ç»“æŸï¼‰
- âœ… å®¡æ‰¹æœºåˆ¶å®Œæ•´ï¼ˆä¼šç­¾ã€æˆ–ç­¾ã€é¡ºåºå®¡æ‰¹ï¼‰
- âœ… å®¡æ‰¹äººè§£æå™¨ï¼ˆ5ç§æ–¹å¼ï¼šè§’è‰²ã€éƒ¨é—¨ã€æŒ‡å®šã€ä¸Šçº§ã€è¡¨å•ï¼‰
- âœ… ç©ºå®¡æ‰¹äººå¤„ç†ç­–ç•¥ï¼ˆè·³è¿‡ã€è½¬ç®¡ç†å‘˜ã€æŠ¥é”™ï¼‰
- âœ… æŠ„é€åŠŸèƒ½è‡ªåŠ¨å¤„ç†
- âœ… æ¡ä»¶åˆ†æ”¯åŠ¨æ€è®¡ç®—
- âœ… é¢†åŸŸäº‹ä»¶ç³»ç»Ÿï¼ˆ5ç§äº‹ä»¶ + 4ä¸ªå¤„ç†å™¨ï¼‰

**å‰ç«¯å®Œæˆåº¦ï¼š80%**
- âœ… åˆ†ç±»ç®¡ç†ï¼ˆå¤šçº§æ”¯æŒ + é¢œè‰²é…ç½®ï¼‰
- âœ… æµç¨‹å®šä¹‰ç®¡ç†ï¼ˆåˆ—è¡¨ + è®¾è®¡å™¨ï¼‰
- âœ… æµç¨‹è®¾è®¡å™¨ï¼ˆ@antv/x6 é›†æˆï¼Œ6ç§èŠ‚ç‚¹ï¼‰
- âœ… èŠ‚ç‚¹é…ç½®é¢æ¿ï¼ˆå®¡æ‰¹äººã€æ¡ä»¶ã€æŠ„é€ï¼‰
- âœ… è¡¨å•è®¾è®¡å™¨ï¼ˆåŠ¨æ€å­—æ®µé…ç½®ï¼‰
- âœ… æœåŠ¡å±‚APIå°è£…ï¼ˆ5ä¸ªæœåŠ¡æ–‡ä»¶ï¼‰
- âœ… è·¯ç”±å’Œæƒé™é…ç½®å®Œæ•´

### ğŸ¯ ç³»ç»Ÿç‰¹ç‚¹

1. **æ¶æ„å…ˆè¿›**ï¼šé‡‡ç”¨ CQRS + äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œä¸ç°æœ‰ç³»ç»Ÿä¿æŒä¸€è‡´
2. **åŠŸèƒ½å®Œæ•´**ï¼šè¦†ç›–æµç¨‹è®¾è®¡ã€å‘èµ·ã€å®¡æ‰¹ã€ç›‘æ§å…¨æµç¨‹
3. **æ‰©å±•æ€§å¼º**ï¼šèŠ‚ç‚¹ç±»å‹å’Œå®¡æ‰¹ç­–ç•¥é‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼Œæ˜“äºæ‰©å±•
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šæµç¨‹å®šä¹‰å¯ç¼“å­˜ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯
5. **å®‰å…¨å¯é **ï¼šå®Œæ•´çš„æƒé™æ§åˆ¶å’Œå¹¶å‘å®‰å…¨å¤„ç†

### ğŸ”® åç»­ä¼˜åŒ–æ–¹å‘

1. **P1ä¼˜å…ˆçº§**ï¼šå‚¬åŠåŠŸèƒ½ã€æµç¨‹å›¾å¯è§†åŒ–ã€ä¸šåŠ¡å›è°ƒæ¥å£
2. **P2ä¼˜å…ˆçº§**ï¼šè¶…æ—¶å¤„ç†ã€ç›‘æ§æŠ¥è¡¨ã€ç‰ˆæœ¬ç®¡ç†
3. **ä½“éªŒä¼˜åŒ–**ï¼šç§»åŠ¨ç«¯é€‚é…ã€æ¶ˆæ¯æ¨é€ã€æ‰¹é‡æ“ä½œ

**ç³»ç»Ÿå·²å…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¡ä»¶ï¼** ğŸš€

## åã€æµç¨‹åˆ†ç±»è®¾è®¡ï¼ˆæ–°å¢ï¼‰

### 8.1 å¤šçº§åˆ†ç±»æ”¯æŒ

ä¸ºäº†æ»¡è¶³ä¸åŒä¸šåŠ¡åœºæ™¯çš„åˆ†ç±»éœ€æ±‚ï¼Œç³»ç»Ÿæ”¯æŒæ— é™å±‚çº§çš„æµç¨‹åˆ†ç±»ç®¡ç†ï¼š

```
ç¤ºä¾‹åˆ†ç±»ç»“æ„ï¼š
â”œâ”€â”€ è¡Œæ”¿ç±»
â”‚   â”œâ”€â”€ è¯·å‡ç”³è¯·
â”‚   â”‚   â”œâ”€â”€ å¹´å‡ç”³è¯·
â”‚   â”‚   â”œâ”€â”€ ç—…å‡ç”³è¯·
â”‚   â”‚   â””â”€â”€ äº‹å‡ç”³è¯·
â”‚   â””â”€â”€ å‡ºå·®ç”³è¯·
â”œâ”€â”€ è´¢åŠ¡ç±»
â”‚   â”œâ”€â”€ æŠ¥é”€ç”³è¯·
â”‚   â”‚   â”œâ”€â”€ å·®æ—…æŠ¥é”€
â”‚   â”‚   â””â”€â”€ æ—¥å¸¸æŠ¥é”€
â”‚   â””â”€â”€ ä»˜æ¬¾ç”³è¯·
â””â”€â”€ äººäº‹ç±»
    â”œâ”€â”€ å…¥èŒç”³è¯·
    â””â”€â”€ ç¦»èŒç”³è¯·
```

### 8.2 åˆ†ç±»æ¨¡å‹è®¾è®¡

```typescript
interface WfCategory {
  id: number;              // ä¸»é”®
  code: string;            // åˆ†ç±»ç¼–ç ï¼ˆå”¯ä¸€ï¼‰
  name: string;            // åˆ†ç±»åç§°
  parentId?: number;       // çˆ¶åˆ†ç±»ID
  level: number;           // å±‚çº§ï¼ˆ0å¼€å§‹ï¼‰
  icon?: string;           // å›¾æ ‡ç±»å
  color?: string;          // é¢œè‰²ï¼ˆåå…­è¿›åˆ¶ï¼‰
  sort: number;            // æ’åºå·
  status: 'ENABLED' | 'DISABLED';  // çŠ¶æ€
  remark?: string;         // å¤‡æ³¨
  createdAt: Date;
  updatedAt: Date;
}
```

### 8.3 å‰ç«¯ç»„ä»¶

- **Cascaderç»„ä»¶**ï¼šç”¨äºæµç¨‹å®šä¹‰åˆ—è¡¨çš„å¤šçº§åˆ†ç±»ç­›é€‰
- **TreeSelectç»„ä»¶**ï¼šç”¨äºåˆ†ç±»ç®¡ç†é¡µé¢çš„çˆ¶çº§é€‰æ‹©
- **é¢œè‰²é€‰æ‹©å™¨**ï¼šæ”¯æŒä¸ºåˆ†ç±»è®¾ç½®å¯è§†åŒ–é¢œè‰²
- **ç¼©è¿›æ˜¾ç¤º**ï¼šé€šè¿‡ç©ºæ ¼ç¼©è¿›ç›´è§‚å±•ç¤ºå±‚çº§å…³ç³»

## ä¹ã€å®ç°æ­¥éª¤

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„ï¼ˆP0ï¼‰
1. [x] åœ¨ schema.prisma æ·»åŠ å·¥ä½œæµæ¨¡å‹
2. [x] æ‰§è¡Œæ•°æ®åº“è¿ç§» `pnpm db:push`
3. [x] åˆ›å»ºåç«¯ workflow æ¨¡å—éª¨æ¶
4. [x] æ·»åŠ å‰ç«¯è·¯ç”±å’Œæƒé™å¸¸é‡

### é˜¶æ®µäºŒï¼šæµç¨‹å®šä¹‰ï¼ˆP0ï¼‰
5. [x] åç«¯ï¼šæµç¨‹åˆ†ç±» CRUD APIï¼ˆå«å¤šçº§æ”¯æŒï¼‰
6. [x] å‰ç«¯ï¼šæµç¨‹åˆ†ç±»ç®¡ç†é¡µé¢ï¼ˆTreeSelect + é¢œè‰²é€‰æ‹©å™¨ï¼‰
7. [x] å‰ç«¯ï¼šæµç¨‹å®šä¹‰åˆ—è¡¨é¡µï¼ˆæ”¯æŒå¤šçº§åˆ†ç±»ç­›é€‰ï¼‰
8. [x] åç«¯ï¼šæµç¨‹å®šä¹‰ CRUD API
9. [x] åç«¯ï¼šèŠ‚ç‚¹é…ç½®ä¿å­˜é€»è¾‘
10. [x] å‰ç«¯ï¼šæµç¨‹è®¾è®¡å™¨ï¼ˆé›†æˆ @antv/x6ï¼‰
11. [x] å‰ç«¯ï¼šèŠ‚ç‚¹é…ç½®é¢æ¿ï¼ˆå®¡æ‰¹äººã€æ¡ä»¶ã€è¡¨å•æƒé™ï¼‰

### é˜¶æ®µä¸‰ï¼šæµç¨‹å¼•æ“ï¼ˆP0ï¼‰
12. [x] **åç«¯ï¼šCQRS æ¶æ„é‡æ„**
    - [x] åˆ›å»ºå‘½ä»¤ç±»ï¼ˆcommands/ï¼‰
    - [x] åˆ›å»ºæŸ¥è¯¢ç±»ï¼ˆqueries/ï¼‰
    - [x] åˆ›å»ºå‘½ä»¤å¤„ç†å™¨ï¼ˆhandlers/commands/ï¼‰
    - [x] åˆ›å»ºæŸ¥è¯¢å¤„ç†å™¨ï¼ˆhandlers/queries/ï¼‰
    - [x] æ›´æ–° Controller ä½¿ç”¨ CommandBus/QueryBus
    - [x] æ›´æ–° WorkflowModule æ³¨å†Œå¤„ç†å™¨
13. [x] åç«¯ï¼šæµç¨‹å¼•æ“æœåŠ¡ï¼ˆå¯åŠ¨ã€æ‰§è¡Œã€æ¨è¿›ï¼‰
14. [x] åç«¯ï¼šæ¡ä»¶è®¡ç®—å™¨
15. [x] åç«¯ï¼šå®¡æ‰¹äººè§£æå™¨ï¼ˆè§’è‰²/éƒ¨é—¨/æŒ‡å®šï¼‰
16. [x] åç«¯ï¼šä¼šç­¾/æˆ–ç­¾é€»è¾‘

### é˜¶æ®µå››ï¼šå®¡æ‰¹åŠŸèƒ½ï¼ˆP0ï¼‰
17. [x] åç«¯ï¼šä»»åŠ¡ CRUD å’Œå®¡æ‰¹æ“ä½œ API
18. [x] å‰ç«¯ï¼šå¾…åŠä»»åŠ¡åˆ—è¡¨
19. [x] å‰ç«¯ï¼šä»»åŠ¡è¯¦æƒ…å’Œå®¡æ‰¹å¼¹çª—
20. [x] å‰ç«¯ï¼šæµç¨‹å†å²æ—¶é—´çº¿

### é˜¶æ®µäº”ï¼šä»»åŠ¡ä¸­å¿ƒï¼ˆP0ï¼‰
21. [x] æˆ‘å‘èµ·çš„æµç¨‹
22. [x] æŠ„é€è®°å½•ï¼ˆæŠ„é€æˆ‘çš„ï¼‰

### é˜¶æ®µå…­ï¼šäº‹ä»¶å¤„ç†ï¼ˆP0ï¼‰
23. [x] é¢†åŸŸäº‹ä»¶åˆ›å»ºï¼ˆæµç¨‹å¯åŠ¨ã€å®Œæˆã€é©³å›ã€ä»»åŠ¡é€šè¿‡/é©³å›ï¼‰
24. [x] äº‹ä»¶å¤„ç†å™¨ï¼ˆæ—¥å¿—è®°å½•ã€é€šçŸ¥å¤„ç†ï¼‰

### é˜¶æ®µä¸ƒï¼šé«˜çº§åŠŸèƒ½ï¼ˆP1ï¼‰
25. [ ] å‚¬åŠåŠŸèƒ½
26. [ ] æµç¨‹å®ä¾‹è¯¦æƒ…é¡µï¼ˆæµç¨‹å›¾å¯è§†åŒ–ï¼‰
27. [ ] è¶…æ—¶å¤„ç†ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰

### é˜¶æ®µå…«ï¼šä¸šåŠ¡é›†æˆï¼ˆP1ï¼‰
28. [ ] ä¸šåŠ¡å›è°ƒæ¥å£è®¾è®¡
29. [ ] ç¤ºä¾‹ï¼šè®¢å•å®¡æ‰¹é›†æˆ

### é˜¶æ®µä¹ï¼šé«˜çº§åŠŸèƒ½ï¼ˆP2ï¼‰
30. [ ] æµç¨‹ç›‘æ§æŠ¥è¡¨
31. [ ] æµç¨‹ç‰ˆæœ¬ç®¡ç†

---

## åä¸€ã€å…³é”®æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | æ“ä½œ | çŠ¶æ€ |
|------|------|------|
| `apps/admin-api/prisma/schema.prisma` | æ·»åŠ å·¥ä½œæµæ¨¡å‹ | âœ… |
| `apps/admin-api/src/app.module.ts` | æ³¨å†Œ WorkflowModule | âœ… |
| `apps/admin-api/src/modules/workflow/` | æ–°å»ºæ•´ä¸ªæ¨¡å— | âœ… |
| `apps/admin-api/src/modules/workflow/category/` | åˆ†ç±»ç®¡ç†æ¨¡å— | âœ… |
| `apps/admin-api/src/modules/workflow/commands/` | CQRS å‘½ä»¤ç±» | âœ… |
| `apps/admin-api/src/modules/workflow/queries/` | CQRS æŸ¥è¯¢ç±» | âœ… |
| `apps/admin-api/src/modules/workflow/handlers/` | CQRS å¤„ç†å™¨ | âœ… |
| `apps/admin-web/src/App.tsx` | æ·»åŠ å·¥ä½œæµè·¯ç”± | âœ… |
| `apps/admin-web/src/pages/workflow/` | æ–°å»ºé¡µé¢ | âœ… |
| `apps/admin-web/src/pages/workflow/category/` | åˆ†ç±»ç®¡ç†é¡µé¢ | âœ… |
| `apps/admin-web/src/services/workflow/` | æ–°å»º API æœåŠ¡ | âœ… |
| `apps/admin-web/src/constants/permissions.ts` | æ·»åŠ æƒé™å¸¸é‡ | âœ… |

---

## åäºŒã€æ³¨æ„äº‹é¡¹

1. **å¹¶å‘å®‰å…¨**ï¼šä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ï¼Œä¼šç­¾åœºæ™¯åŠ é”
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šæµç¨‹å®šä¹‰ç¼“å­˜åˆ° Redis
3. **æ‰©å±•æ€§**ï¼šèŠ‚ç‚¹ç±»å‹å’Œå®¡æ‰¹äººè§£æå™¨é‡‡ç”¨ç­–ç•¥æ¨¡å¼
4. **å®‰å…¨**ï¼šåªæœ‰æŒ‡å®šå®¡æ‰¹äººæ‰èƒ½å®¡æ‰¹ï¼Œè¡¨å•å­—æ®µæŒ‰é…ç½®æ§åˆ¶å¯è§æ€§

---

## åä¸‰ã€å‚è€ƒèµ„æ–™

- NestJS CQRS æ–‡æ¡£: https://docs.nestjs.com/recipes/cqrs
- @antv/x6 æ–‡æ¡£: https://x6.antv.antgroup.com/
- ç°æœ‰ Job æ¨¡å— CQRS å®ç°: `apps/admin-api/src/modules/system/job/`
